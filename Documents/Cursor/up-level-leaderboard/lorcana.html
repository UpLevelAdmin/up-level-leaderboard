<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lorcana Weelky Tournaments</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&family=Chonburi&display=swap"
        rel="stylesheet">
    <style>
        * {
            font-family: 'Kanit', sans-serif;
            box-sizing: border-box;
        }

        body {
            background: url('https://ravensburger.cloud/cms/gallery/lorcana-web/products/s11-winterspell/background/dlc_s11_dark_background_1920x1920.jpg') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            overflow-x: hidden;
            color: #e0e0e0;
        }

        #fireworks-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 999;
            pointer-events: none;
            opacity: 0.6;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 40px;
            margin-bottom: 20px;
            gap: 20px;
            z-index: 20;
            position: relative;
            flex-wrap: wrap;
        }

        .logo-container img {
            max-height: 100px;
            width: auto;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
            transition: transform 0.3s;
        }

        .logo-container img:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.5));
        }

        .container {
            max-width: 900px;
            margin: 0 auto 32px auto;
            padding: 32px;
            background: rgba(13, 27, 42, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 0 30px rgba(100, 200, 255, 0.1), 0 8px 24px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            z-index: 10;
        }

        .logo {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 16px;
            width: 100%;
            gap: 16px;
            padding-top: 20px;
        }

        .logo img {
            max-width: 150px;
            display: block;
            margin: 0;
        }

        h2 {
            color: #82b1ff;
            text-align: center;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(130, 177, 255, 0.5);
            margin-bottom: 30px;
            font-size: 2em;
        }

        .date-header {
            padding: 12px 16px;
            margin-top: 24px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 8px 8px 0 0;
            text-align: left;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #fff;
        }

        /* Core Construct Theme (Monday) - Icy Blue */
        .header-monday {
            border-left: 6px solid #4fc3f7;
            background: linear-gradient(90deg, #102a43 0%, #243b53 100%);
        }

        /* Pack Rush Theme (Wednesday) - Deep Purple */
        .header-wednesday {
            border-left: 6px solid #ba68c8;
            background: linear-gradient(90deg, #240046 0%, #3c096c 100%);
        }

        /* Generic */
        .header-generic {
            border-left: 6px solid #455a64;
            background: linear-gradient(90deg, #fff 0%, #eceff1 100%);
        }

        .event-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            color: white;
            margin-left: 8px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .badge-core {
            background: #0288d1;
            box-shadow: 0 0 10px rgba(2, 136, 209, 0.5);
        }

        .badge-pack {
            background: #7b1fa2;
            box-shadow: 0 0 10px rgba(123, 31, 162, 0.5);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0;
            margin-bottom: 16px;
            background: rgba(30, 40, 60, 0.6);
            border-radius: 0 0 12px 12px;
            overflow: hidden;
            color: #e0e0e0;
        }

        th,
        td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            font-weight: 600;
            font-size: 1.05em;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tr:hover td {
            background: rgba(255, 255, 255, 0.05);
        }

        .buttons-container {
            display: flex;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
            margin: 24px auto;
        }

        .register-btn {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 0 auto 30px auto;
            padding: 16px 24px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA000 100%);
            color: #3e2723;
            font-size: 1.3em;
            font-weight: 700;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .register-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            background: linear-gradient(135deg, #FFEC00 0%, #FFB300 100%);
        }

        .toggle-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 4px 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }

        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Details Section */
        .details-section {
            max-width: 800px;
            margin: 0 auto 24px auto;
            padding: 24px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .spinner {
            margin: 24px auto 8px auto;
            border: 6px solid rgba(255, 255, 255, 0.1);
            border-top: 6px solid #82b1ff;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .home-button {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            text-decoration: none;
            transition: transform 0.2s;
            z-index: 100;
        }

        .home-button:hover {
            transform: scale(1.1);
        }

        .home-button::before {
            content: 'üè†';
            font-size: 20px;
        }

        @media (max-width: 600px) {
            .buttons-container {
                flex-direction: column;
                align-items: center;
            }

            .register-btn {
                width: 100%;
                max-width: 300px;
            }
        }

        /* Font fix for dark mode */
        h4,
        h3 {
            color: #fff !important;
        }

        ul {
            color: #ccc !important;
        }

        .logo-box {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        /* Mobile adjustment */
        @media (max-width: 600px) {
            .logo-container {
                flex-direction: column;
                gap: 10px;
            }

            .logo-container img {
                max-height: 80px;
            }
        }

        /* Codename Rank Effects (Copied from Gym Battle) */
        .codename-rank[data-rank="Rookie"] .codename {
            color: #888888;
            font-size: 1.05em;
        }

        .codename-rank[data-rank="Bronze"] .codename {
            color: #b87333;
            font-size: 1.08em;
        }

        .codename-rank[data-rank="Silver"] .codename {
            color: #9e9e9e;
            font-size: 1.12em;
        }

        .codename-rank[data-rank="Gold"] .codename {
            color: #ffd700;
            font-size: 1.18em;
            font-weight: bold;
        }

        .codename-rank[data-rank="Platinum"] .codename {
            color: #00bcd4;
            font-size: 1.22em;
            font-weight: bold;
        }

        .codename-rank[data-rank="Diamond"] .codename {
            color: #00bfff;
            font-size: 1.28em;
            font-weight: bold;
        }

        .codename-rank[data-rank="Grandmaster"] .codename {
            color: #8e24aa;
            font-size: 1.35em;
            font-weight: bold;
        }

        .codename-rank[data-rank="Legend"] .codename {
            color: #e53935;
            font-size: 1.45em;
            font-weight: bold;
        }

        .codename-rank[data-rank="Gold"] .codename,
        .codename-rank[data-rank="Platinum"] .codename,
        .codename-rank[data-rank="Diamond"] .codename,
        .codename-rank[data-rank="Grandmaster"] .codename,
        .codename-rank[data-rank="Legend"] .codename {
            animation: blink 1s step-end infinite alternate;
        }

        @keyframes blink {
            0% {
                opacity: 1;
                text-shadow: 0 0 8px #fff, 0 0 16px currentColor;
            }

            100% {
                opacity: 0.6;
                text-shadow: 0 0 2px #fff, 0 0 4px currentColor;
            }
        }

        /* Wave (Gold) */
        @keyframes wave {

            0%,
            100% {
                transform: translateY(0);
            }

            20% {
                transform: translateY(-5px);
            }

            40% {
                transform: translateY(-10px);
            }

            60% {
                transform: translateY(-5px);
            }

            80% {
                transform: translateY(0);
            }
        }

        .codename.wave span {
            display: inline-block;
            animation: wave 1.2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        .codename.wave.gold span {
            animation-duration: 1.2s;
        }

        .codename.wave.platinum span {
            animation-duration: 1s;
        }

        .codename.wave.diamond span {
            animation-duration: 0.85s;
        }

        .codename.wave.grandmaster span {
            animation-duration: 0.7s;
        }

        .codename.wave.legend span {
            animation-duration: 0.6s;
        }

        .codename.wave span:nth-child(1) {
            animation-delay: 0s;
        }

        .codename.wave span:nth-child(2) {
            animation-delay: 0.08s;
        }

        .codename.wave span:nth-child(3) {
            animation-delay: 0.16s;
        }

        .codename.wave span:nth-child(4) {
            animation-delay: 0.24s;
        }

        .codename.wave span:nth-child(5) {
            animation-delay: 0.32s;
        }

        .codename.wave span:nth-child(6) {
            animation-delay: 0.40s;
        }

        .codename.wave span:nth-child(7) {
            animation-delay: 0.48s;
        }

        .codename.wave span:nth-child(8) {
            animation-delay: 0.56s;
        }

        .codename.wave span:nth-child(9) {
            animation-delay: 0.64s;
        }

        .codename.wave span:nth-child(10) {
            animation-delay: 0.72s;
        }
    \n
    /* Master Championest Fire Breathing Effect */
    .codename.fire-breath {
      color: #111 !important; /* ‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏î‡∏≥‡∏™‡∏ô‡∏¥‡∏ó */
      font-weight: 800;
      letter-spacing: 1px;
      animation: fire-glow 2.5s infinite alternate;
    }

    @keyframes fire-glow {
      0% {
        text-shadow: 
          0 0 2px #fff, 
          0 0 4px #fffc00, 
          0 0 8px #ff7300, 
          0 0 12px #ff0000;
      }
      50% {
        text-shadow: 
          0 0 3px #fff, 
          0 0 8px #fffc00, 
          0 0 15px #ff7300, 
          0 0 25px #ff0000,
          0 -5px 15px rgba(255, 0, 0, 0.6);
      }
      100% {
        text-shadow: 
          0 0 2px #fff, 
          0 0 6px #fffc00, 
          0 0 10px #ff7300, 
          0 0 18px #ff0000;
      }
    }
\n</style>
</head>

<body>
    <canvas id="fireworks-canvas"></canvas>
    <a href="index.html" class="home-button" title="‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å"></a>

    <div class="logo-container">
        <img src="https://i.postimg.cc/wjzpnxjB/Up-Level-01-1.png" alt="Up Level Logo">
        <img src="https://www.disneylorcana.com/_nuxt/logo-br-2x.Sweb4xgr.png" alt="Disney Lorcana Logo">
    </div>

    <div class="container">
        <!-- Logo removed from inside container -->

        <h2>Lorcana Weekly Tournaments</h2>

        <!-- Single Register Button -->
        <a href="https://forms.gle/HGUPsd9cSDRFvdZS9" target="_blank" class="register-btn">
            ‚ú® ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô ‚ú®
        </a>

        <!-- Details Section -->
        <div class="details-section">
            <h3 style="color: #82b1ff; margin-top: 0; text-align: center; cursor: pointer; user-select: none;"
                onclick="toggleEventDetails()">
                üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô
                <span id="details-arrow" style="font-size: 0.8em; margin-left: 8px;">‚ñº</span>
            </h3>

            <div id="details-content" style="display: none; animation: fadeIn 0.5s;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">

                    <div
                        style="background: rgba(33, 150, 243, 0.15); padding: 16px; border-radius: 12px; border: 1px solid rgba(33, 150, 243, 0.3);">
                        <h4 style="color: #90caf9; margin-top: 0; text-align: center;">üîµ Monday Core Construct</h4>
                        <ul style="padding-left: 20px; color: #e0e0e0;">
                            <li><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå 19:00 ‡∏ô.</li>
                            <li><strong>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:</strong> Core Construct</li>
                            <li><strong>‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</strong> ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô</li>
                            <li><strong>‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•:</strong> Lorcana Booster Packs</li>
                        </ul>
                    </div>

                    <div
                        style="background: rgba(156, 39, 176, 0.15); padding: 16px; border-radius: 12px; border: 1px solid rgba(156, 39, 176, 0.3);">
                        <h4 style="color: #ce93d8; margin-top: 0; text-align: center;">üü£ Wednesday Pack Rush</h4>
                        <ul style="padding-left: 20px; color: #e0e0e0;">
                            <li><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò 19:00 ‡∏ô.</li>
                            <li><strong>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:</strong> Pack Rush (‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏î‡πá‡∏Ñ)</li>
                            <li><strong>‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</strong> ‡∏Ñ‡πà‡∏≤‡∏ã‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á</li>
                            <li><strong>‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•:</strong> Promo Cards / Packs</li>
                        </ul>
                    </div>

                </div>
                <p style="text-align: center; margin-top: 20px; color: #bdbdbd; font-size: 0.9em;">
                    *‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡∏≤‡∏á‡πÄ‡∏û‡∏à‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏° Line
                </p>
            </div>
        </div>

        <!-- List Section -->
        <h3 style="text-align:center; color:#333; margin-top:32px;">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h3>
        <div id="player-list" style="text-align:center;">
            <div class="spinner"></div>
            <div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
        </div>

    </div>

    <script>
        // Configuration
        // TODO: ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Apps Script ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        // const apiUrl = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec?type=json";
        const apiUrl = "https://script.google.com/macros/s/AKfycbyjzjobTlpCVH6t02ioAzPLoJlAAYBFJfD397ab5OoLvDjl7SEFG4u1O5nRjsoGlhko/exec"; // Updated URL

        // Member Dashboard API for Ranks
        const memberDashboardApi = "https://script.google.com/macros/s/AKfycbxtjsDwHI6nJU4OIHExUxMaZwUn3qwakvdkzwbQO7C8Trzz5Gh84SX6F1gqb4BOFQcn/exec?func=getMemberDashboardData";

        const rankEmojis = {
            "Rookie": "üê£", "Rookie II": "üê£", "Rookie III": "üê£", "Rookie IV": "üê£", "Rookie V": "üê£",
            "Bronze": "üõ°Ô∏è", "Bronze II": "üõ°Ô∏è", "Bronze III": "üõ°Ô∏è", "Bronze IV": "üõ°Ô∏è", "Bronze V": "üõ°Ô∏è",
            "Silver": "‚öîÔ∏è", "Silver II": "‚öîÔ∏è", "Silver III": "‚öîÔ∏è", "Silver IV": "‚öîÔ∏è", "Silver V": "‚öîÔ∏è",
            "Gold": "ü•á", "Gold II": "ü•á", "Gold III": "ü•á", "Gold IV": "ü•á", "Gold V": "ü•á",
            "Platinum": "‚ú®", "Platinum II": "‚ú®", "Platinum III": "‚ú®", "Platinum IV": "‚ú®", "Platinum V": "‚ú®",
            "Diamond": "üíé", "Diamond II": "üíé", "Diamond III": "üíé", "Diamond IV": "üíé", "Diamond V": "üíé",
            "Grandmaster": "üëë", "Grandmaster II": "üëë", "Grandmaster III": "üëë", "Grandmaster IV": "üëë", "Grandmaster V": "üëë",
            "Legend": "üêâ", "Legend II": "üêâ", "Legend III": "üêâ", "Legend IV": "üêâ", "Legend V": "üêâ"
        };

        function getBaseRank(rank) {
            if (!rank) return "Rookie";
            const baseRank = rank.replace(/\s+(II|III|IV|V|VI|VII|VIII|IX|X|\d+)$/, '');
            return baseRank || "Rookie";
        }

        function getRankEmoji(rank) {
            if (!rank) return "üê£";
            if (rankEmojis[rank]) return rankEmojis[rank];
            const baseRank = getBaseRank(rank);
            return rankEmojis[baseRank] || "üê£";
        }

        function renderCodenameEffect(codename, rank) {
            const chars = ['[', ...codename.split(''), ']'];
            const waveRanks = ['Gold', 'Platinum', 'Diamond', 'Grandmaster', 'Legend'];
            const baseRank = getBaseRank(rank);
            if (waveRanks.includes(baseRank)) {
                return `<span class="codename wave ${baseRank.toLowerCase()}">${chars.map(ch => `<span>${ch}</span>`).join('')}</span>`;
            } else {
                return `<span class="codename">[${codename}]</span>`;
            }
        }

        // Function to generate upcoming dates
        function getUpcomingDates() {
            // Specific dates requested for end of Feb 2026
            const dates = [];

            // Monday 23 Feb 2026
            dates.push({ date: new Date(2026, 1, 23), type: 'Core Construct', dayName: '‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå' });

            // Wednesday 25 Feb 2026
            dates.push({ date: new Date(2026, 1, 25), type: 'Pack Rush', dayName: '‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò' });

            return dates;
        }

        function formatDateThai(date) {
            const months = [
                "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
                "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"
            ];
            return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear() + 543}`;
        }

        // Mock Data Generator
        function generateMockData(dates) {
            const groupedData = {};
            dates.forEach(item => {
                const dateKey = `${item.dayName}‡∏ó‡∏µ‡πà ${formatDateThai(item.date)}`;
                // Mock removed mainly to rely on real data structure, but kept logic
                groupedData[dateKey] = [];
            });
            return { groupedData };
        }

        document.addEventListener('DOMContentLoaded', () => {
            const upcomingEvents = getUpcomingDates();

            // Fetch data
            const fetchDataPromise = apiUrl ? fetch(apiUrl).then(res => res.json()).catch(() => generateMockData(upcomingEvents)) : Promise.resolve(generateMockData(upcomingEvents));
            const fetchMembersPromise = fetch(memberDashboardApi).then(res => res.json()).catch(err => []);

            Promise.all([fetchDataPromise, fetchMembersPromise]).then(([data, members]) => {
                const container = document.getElementById('player-list');

                // Construct Phone Map for Ranks
                const phoneMap = {};
                if (members && Array.isArray(members)) {
                    members.forEach(m => {
                        const phone = String(m.phone).replace(/[^\d]/g, "");
                        phoneMap[phone] = { codename: m.codename, rank: m.rank };
                    });
                }

                let html = '';

                // Sort events by date
                // upcomingEvents is already sorted by loop

                upcomingEvents.forEach((event, idx) => {
                    const dateStr = `${event.dayName}‡∏ó‡∏µ‡πà ${formatDateThai(event.date)}`;
                    // Try to find matching key in data (assuming API returns flexible keys or we match by date)
                    // For now, let's look for exact string match or just show empty table

                    const players = (data.groupedData && data.groupedData[dateStr]) ? data.groupedData[dateStr] : [];

                    const isMonday = event.type === 'Core Construct';
                    const headerClass = isMonday ? 'header-monday' : 'header-wednesday';
                    const badgeClass = isMonday ? 'badge-core' : 'badge-pack';
                    const headerColor = isMonday ? '#1565c0' : '#7b1fa2'; // for th background
                    const thColor = isMonday ? '#1976d2' : '#8e24aa';

                    const groupId = `group-${idx}`;
                    const isFirst = idx === 0;
                    const toggleText = isFirst ? "‡∏ã‡πà‡∏≠‡∏ô" : "‡πÅ‡∏™‡∏î‡∏á";
                    const displayStyle = isFirst ? "" : "display:none;";

                    html += `
            <div class="date-header ${headerClass}">
              <div>
                <span>${dateStr}</span>
                <span class="event-badge ${badgeClass}">${event.type}</span>
                <span style="font-size:0.9em; color:#666; margin-left:8px;">(${players.length} ‡∏Ñ‡∏ô)</span>
              </div>
              <button class="toggle-btn" data-target="${groupId}">${toggleText}</button>
            </div>
            
            <table id="${groupId}" style="${displayStyle}">
              <thead>
                <tr>
                  <th style="background:${thColor}; width:15%;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                  <th style="background:${thColor};">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</th>
                  <th style="background:${thColor}; width:20%;">‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                  <th style="background:${thColor}; width:20%;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                </tr>
              </thead>
              <tbody>
          `;

                    if (players.length === 0) {
                        html += `<tr><td colspan="4" style="padding:20px; color:#999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</td></tr>`;
                    } else {
                        players.forEach((p, i) => {
                            // Determine status badge color
                            let statusBadge = '<span style="color:#ccc">Confirmed</span>';

                            if (p.status === 'Waiting') {
                                statusBadge = '<span style="background:#ffcdd2; color:#b71c1c; padding:2px 8px; border-radius:4px; font-size:0.85em; font-weight:500;">‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</span>';
                            } else if (p.status === 'Pending') {
                                statusBadge = '<span style="background:#fff3cd; color:#856404; padding:2px 8px; border-radius:4px; font-size:0.85em; font-weight:500;">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ</span>';
                            } else if (p.status === 'Paid') {
                                statusBadge = '<span style="background:#c8e6c9; color:#1b5e20; padding:2px 8px; border-radius:4px; font-size:0.85em; font-weight:500;">‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</span>';
                            }

                            // Member Match Logic
                            let displayName = p.nickname;
                            let userLevel = p.level || '-';
                            let phone = String(p.phone || '').replace(/[^\d]/g, "");
                            const profile = phoneMap[phone];

                            if ((profile && profile.codename && profile.rank) || String(phone).endsWith('971156555')) {
              const rank = profile ? profile.rank : '';
              const codenameStr = profile ? profile.codename : '';
              const emoji = getRankEmoji(rank, phone);
              const codenameHtml = renderCodenameEffect(codenameStr, rank, phone);
              displayName += `<br><span class="codename-rank" data-rank="${rank}"><span>${emoji}</span> ${codenameHtml} <span>${emoji}</span></span>`;
            }

                            html += `
                <tr>
                  <td>${i + 1}</td>
                  <td>${displayName}</td>
                  <td>${userLevel}</td>
                  <td>${statusBadge}</td> 
                </tr>
              `;
                        });
                    }

                    html += `</tbody></table>`;
                });

                container.innerHTML = html;

                // Add toggle listeners
                document.querySelectorAll('.toggle-btn').forEach(btn => {
                    btn.addEventListener('click', function () {
                        const targetId = this.getAttribute('data-target');
                        const table = document.getElementById(targetId);
                        if (table.style.display === 'none') {
                            table.style.display = '';
                            this.textContent = '‡∏ã‡πà‡∏≠‡∏ô';
                        } else {
                            table.style.display = 'none';
                            this.textContent = '‡πÅ‡∏™‡∏î‡∏á';
                        }
                    });
                });

            });
        });

        function toggleEventDetails() {
            const content = document.getElementById('details-content');
            const arrow = document.getElementById('details-arrow');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                arrow.textContent = '‚ñ≤';
            } else {
                content.style.display = 'none';
                arrow.textContent = '‚ñº';
            }
        }

        // Snow Animation
        const canvas = document.getElementById('fireworks-canvas'); // Reusing the ID for convenience
        const ctx = canvas.getContext('2d');
        let w, h;
        const snowflakes = [];

        function resize() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        class Snowflake {
            constructor() {
                this.x = Math.random() * w;
                this.y = Math.random() * h;
                this.vx = (Math.random() - 0.5) * 1;
                this.vy = Math.random() * 1 + 0.5;
                this.size = Math.random() * 3 + 1;
                this.opacity = Math.random() * 0.5 + 0.3;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;

                if (this.y > h) {
                    this.y = -10;
                    this.x = Math.random() * w;
                }
                if (this.x > w) this.x = 0;
                if (this.x < 0) this.x = w;
            }

            draw() {
                ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initSnow() {
            for (let i = 0; i < 150; i++) {
                snowflakes.push(new Snowflake());
            }
        }

        function animate() {
            ctx.clearRect(0, 0, w, h);
            snowflakes.forEach(flake => {
                flake.update();
                flake.draw();
            });
            requestAnimationFrame(animate);
        }

        initSnow();
        animate();
    </script>
</body>

</html>