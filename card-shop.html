<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô - Up Level Guild</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: 'Mitr', 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 1rem;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 32px auto;
      padding: 0 16px 32px 16px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    .logo {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 16px;
      padding-top: 16px;
      width: 100%;
    }

    .logo img {
      max-width: 120px;
      display: block;
      margin: 0 auto;
    }

    h2 {
      color: #388e3c;
      text-align: center;
      margin-bottom: 8px;
      font-size: 2em;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 16px;
      font-size: 1.1em;
    }

    .info-box {
      background: #fff3e0;
      border-left: 4px solid #ff9800;
      padding: 16px;
      margin: 0 16px 24px 16px;
      border-radius: 8px;
      font-size: 0.95em;
      line-height: 1.6;
      color: #e65100;
    }

    .info-box strong {
      color: #bf360c;
    }

    .filter-section {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-bottom: 24px;
      padding: 16px;
      background: #f5f5f5;
      border-radius: 12px;
      box-sizing: border-box;
    }

    .search-box {
      flex: 1;
      min-width: 200px;
      max-width: 100%;
      padding: 12px 16px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1em;
      transition: border-color 0.3s;
      box-sizing: border-box;
      width: 100%;
    }

    .search-box:focus {
      outline: none;
      border-color: #667eea;
    }

    .sort-select {
      padding: 12px 16px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1em;
      background: white;
      cursor: pointer;
      box-sizing: border-box;
      min-width: 200px;
      max-width: 100%;
    }

    .stats {
      text-align: center;
      margin-bottom: 16px;
      color: #666;
      font-size: 1.1em;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
      padding: 16px 0;
    }

    @media (max-width: 768px) {
      .cards-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
    }

    .card-item {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      display: flex;
      flex-direction: column;
      cursor: pointer;
    }

    .card-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      border-color: #667eea;
    }

    .card-item.sold {
      opacity: 0.85;
    }

    .card-item.sold .card-image-container {
      filter: grayscale(100%);
    }

    .card-item.sold .card-image {
      filter: grayscale(100%);
    }

    .card-image-container {
      width: 100%;
      height: 300px;
      background: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
    }

    .card-image {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      border-radius: 8px;
    }

    .card-image-placeholder {
      color: #999;
      font-size: 3em;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
    }

    .image-loading-spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #e0e0e0;
      border-top: 4px solid #42A5F5;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .skeleton-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .skeleton-image {
      width: 100%;
      height: 300px;
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    .skeleton-text {
      height: 20px;
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 4px;
      margin-bottom: 8px;
    }

    .skeleton-text.short {
      width: 60%;
    }

    .skeleton-text.medium {
      width: 80%;
    }

    .card-info {
      padding: 16px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .card-name {
      font-size: 1.2em;
      font-weight: bold;
      color: #333;
      margin-bottom: 8px;
      min-height: 2.4em;
      line-height: 1.2;
    }

    .card-price {
      font-size: 1.5em;
      font-weight: bold;
      color: #e53935;
      margin-bottom: 8px;
    }

    .card-price-label {
      font-size: 0.8em;
      color: #666;
      font-weight: normal;
    }

    .card-details {
      font-size: 0.9em;
      color: #666;
      margin-top: auto;
      padding-top: 12px;
      border-top: 1px solid #eee;
    }

    .card-detail-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .card-detail-label {
      color: #999;
    }

    .card-detail-value {
      color: #333;
      font-weight: 500;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: bold;
      margin-top: 8px;
      background: #4caf50;
      color: white;
    }

    .status-badge.sold {
      background: #e53935;
      color: white;
    }

    .spinner {
      margin: 48px auto;
      border: 6px solid #e0e0e0;
      border-top: 6px solid #42A5F5;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      animation: spin 1s linear infinite;
    }

    .loading-text {
      text-align: center;
      color: #666;
      margin-top: 16px;
    }

    .error-message {
      text-align: center;
      color: #e53935;
      padding: 24px;
      background: #ffebee;
      border-radius: 8px;
      margin: 24px 0;
    }

    .no-cards {
      text-align: center;
      padding: 48px 24px;
      color: #999;
      font-size: 1.2em;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      position: relative;
      margin: auto;
      padding: 20px;
      max-width: 90%;
      max-height: 95vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      overflow-y: auto;
    }

    .modal-header {
      width: 100%;
      text-align: center;
      color: white;
      margin-bottom: 16px;
      flex-shrink: 0;
    }

    .modal-header h3 {
      margin: 0 0 8px 0;
      font-size: 1.5em;
    }

    .modal-images {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
      align-items: flex-start;
      max-width: 100%;
      flex-shrink: 0;
    }

    .modal-image-container {
      flex: 1;
      min-width: 300px;
      max-width: 500px;
      text-align: center;
    }

    .modal-image-container h4 {
      color: white;
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .modal-image {
      max-width: 100%;
      max-height: 50vh;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      object-fit: contain;
    }

    .modal.sold .modal-image {
      filter: grayscale(100%);
    }

    .close-modal {
      position: absolute;
      top: 20px;
      right: 35px;
      color: #f1f1f1;
      font-size: 40px;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.3s;
    }

    .close-modal:hover {
      color: #fff;
    }

    .modal-details {
      width: 100%;
      max-width: 800px;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      color: white;
      flex-shrink: 0;
    }

    .modal-detail-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }

    .modal-detail-label {
      font-weight: bold;
      color: #ffd700;
    }

    .modal-detail-value {
      text-align: right;
    }

    @media (max-width: 768px) {
      .modal-content {
        padding: 10px;
        max-width: 100%;
        max-height: 100vh;
      }

      .modal-header {
        margin-bottom: 12px;
      }

      .modal-header h3 {
        font-size: 1.2em;
        padding: 0 40px 0 10px;
      }

      .modal-images {
        flex-direction: column;
        gap: 16px;
        width: 100%;
      }

      .modal-image-container {
        min-width: 100%;
        max-width: 100%;
      }

      .modal-image-container h4 {
        font-size: 1em;
        margin-bottom: 8px;
      }

      .modal-image {
        max-height: 40vh;
        width: 100%;
      }

      .modal-details {
        padding: 16px;
        margin-top: 16px;
        font-size: 0.9em;
      }

      .modal-detail-row {
        font-size: 0.9em;
        padding: 6px 0;
      }

      .close-modal {
        top: 10px;
        right: 15px;
        font-size: 35px;
        z-index: 2001;
      }

      .cards-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }

      .card-image-container {
        height: 200px;
      }

      .card-info {
        padding: 12px;
      }

      .card-name {
        font-size: 1em;
        min-height: 2em;
      }

      .card-price {
        font-size: 1.2em;
      }

      .card-details {
        font-size: 0.8em;
      }

      .filter-section {
        flex-direction: column;
        padding: 12px;
        margin: 0 8px 16px 8px;
      }

      .search-box {
        min-width: 100%;
        max-width: 100%;
        width: 100%;
        box-sizing: border-box;
      }

      .sort-select {
        min-width: 100%;
        max-width: 100%;
        width: 100%;
        box-sizing: border-box;
      }

      .info-box {
        margin: 0 8px 16px 8px;
        padding: 12px;
        font-size: 0.9em;
      }
    }

    @media (max-width: 480px) {
      .cards-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
      }

      .card-image-container {
        height: 180px;
      }

      .card-name {
        font-size: 0.9em;
        min-height: 1.8em;
      }

      .card-price {
        font-size: 1.1em;
      }

      .card-details {
        font-size: 0.75em;
      }

      .card-detail-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 2px;
      }

      h2 {
        font-size: 1.5em;
      }

      .info-box {
        font-size: 0.85em;
        padding: 10px;
      }

      .modal-content {
        padding: 8px;
      }

      .modal-header h3 {
        font-size: 1em;
      }

      .modal-image {
        max-height: 30vh;
      }
    }
  </style>
</head>
<body>
  <a href="index.html" class="home-button" title="‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å"></a>
  
  <div class="container">
    <div class="logo">
      <img src="https://i.postimg.cc/wjzpnxjB/Up-Level-01-1.png" alt="Up Level Logo">
    </div>
    
    <h2>üè™ ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô</h2>
    <div class="subtitle">‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡πÅ‡∏ü‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô Up Level Academy</div>
    
    <div class="info-box">
      <strong>üìå ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡πÅ‡∏ü‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏≠‡∏á ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏°‡∏≤‡∏î‡∏π‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô<br>
      <strong>üí¨ ‡∏™‡∏ô‡πÉ‡∏à‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏î</strong> ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á
    </div>
    
    <div class="filter-section">
      <input type="text" id="search-box" class="search-box" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πå‡∏î...">
      <select id="sort-select" class="sort-select">
        <option value="name-asc">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠ (‡∏Å-‡∏Æ)</option>
        <option value="name-desc">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠ (‡∏Æ-‡∏Å)</option>
        <option value="price-asc">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ï‡πà‡∏≥-‡∏™‡∏π‡∏á)</option>
        <option value="price-desc">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏™‡∏π‡∏á-‡∏ï‡πà‡∏≥)</option>
        <option value="date-desc">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á (‡πÉ‡∏´‡∏°‡πà-‡πÄ‡∏Å‡πà‡∏≤)</option>
        <option value="date-asc">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á (‡πÄ‡∏Å‡πà‡∏≤-‡πÉ‡∏´‡∏°‡πà)</option>
      </select>
    </div>
    
    <div class="stats" id="stats">
      ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
    </div>
    
    <div id="cards-container">
      <div class="spinner"></div>
      <div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î...</div>
    </div>
  </div>

  <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏ï‡πá‡∏° -->
  <div id="imageModal" class="modal">
    <span class="close-modal" onclick="closeModal()">&times;</span>
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-card-name"></h3>
      </div>
      <div class="modal-images">
        <div class="modal-image-container">
          <h4>‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤</h4>
          <img id="modal-front-image" class="modal-image" src="" alt="‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤" loading="eager" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
          <div style="display:none; color: white; padding: 20px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤</div>
        </div>
        <div class="modal-image-container">
          <h4>‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á</h4>
          <img id="modal-back-image" class="modal-image" src="" alt="‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á" loading="eager" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
          <div style="display:none; color: white; padding: 20px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á</div>
        </div>
      </div>
      <div class="modal-details">
        <div class="modal-detail-row">
          <span class="modal-detail-label">‡∏£‡∏≤‡∏Ñ‡∏≤:</span>
          <span class="modal-detail-value" id="modal-price"></span>
        </div>
        <div class="modal-detail-row">
          <span class="modal-detail-label">‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏ô‡πÅ‡∏ü‡πâ‡∏°:</span>
          <span class="modal-detail-value" id="modal-folder-slot"></span>
        </div>
        <div class="modal-detail-row">
          <span class="modal-detail-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á:</span>
          <span class="modal-detail-value" id="modal-posted-date"></span>
        </div>
        <div class="modal-detail-row" id="modal-notes-row" style="display:none;">
          <span class="modal-detail-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span>
          <span class="modal-detail-value" id="modal-notes"></span>
        </div>
        <div class="modal-detail-row">
          <span class="modal-detail-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</span>
          <span class="modal-detail-value" id="modal-status"></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ‡πÉ‡∏ä‡πâ parameter sheet=shop ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å sheet "‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô"
    const API_URL = "https://script.google.com/macros/s/AKfycbxsbm12v26W8Aa0bGQOVyijD7lWoW9AWgjHQ8HDkLVwO32DJHiiC_NwUpsmiFKALAy7/exec?type=json&sheet=shop";
    
    let allCards = [];
    let filteredCards = [];

    function parsePrice(priceStr) {
      if (!priceStr) return 0;
      const numStr = String(priceStr).replace(/[^\d]/g, '');
      return parseInt(numStr) || 0;
    }

    function parseDate(dateStr) {
      if (!dateStr) return 0;
      const parts = String(dateStr).split('/');
      if (parts.length >= 2) {
        const day = parseInt(parts[0]) || 0;
        const month = parseInt(parts[1]) || 0;
        const year = parts.length === 3 ? parseInt(parts[2]) || 0 : new Date().getFullYear();
        return year * 10000 + month * 100 + day;
      }
      return 0;
    }

    function sortCards(cards, sortBy) {
      const sorted = [...cards];
      
      switch(sortBy) {
        case 'name-asc':
          sorted.sort((a, b) => {
            const nameA = String(a.cardName || '').toLowerCase();
            const nameB = String(b.cardName || '').toLowerCase();
            return nameA.localeCompare(nameB, 'th');
          });
          break;
        case 'name-desc':
          sorted.sort((a, b) => {
            const nameA = String(a.cardName || '').toLowerCase();
            const nameB = String(b.cardName || '').toLowerCase();
            return nameB.localeCompare(nameA, 'th');
          });
          break;
        case 'price-asc':
          sorted.sort((a, b) => {
            const priceA = parsePrice(a.listedPrice);
            const priceB = parsePrice(b.listedPrice);
            return priceA - priceB;
          });
          break;
        case 'price-desc':
          sorted.sort((a, b) => {
            const priceA = parsePrice(a.listedPrice);
            const priceB = parsePrice(b.listedPrice);
            return priceB - priceA;
          });
          break;
        case 'date-desc':
          sorted.sort((a, b) => {
            const dateA = parseDate(a.postedDate);
            const dateB = parseDate(b.postedDate);
            return dateB - dateA;
          });
          break;
        case 'date-asc':
          sorted.sort((a, b) => {
            const dateA = parseDate(a.postedDate);
            const dateB = parseDate(b.postedDate);
            return dateA - dateB;
          });
          break;
      }
      
      return sorted;
    }

    function filterCards(cards, searchTerm) {
      if (!searchTerm) return cards;
      
      const term = searchTerm.toLowerCase().trim();
      return cards.filter(card => {
        const cardName = String(card.cardName || '').toLowerCase();
        const notes = String(card.notes || '').toLowerCase();
        
        return cardName.includes(term) || notes.includes(term);
      });
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function renderCards(cards) {
      const container = document.getElementById('cards-container');
      
      if (cards.length === 0) {
        container.innerHTML = '<div class="no-cards">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</div>';
        return;
      }

      let html = '<div class="cards-grid">';
      
      cards.forEach((card, index) => {
        const imageUrl = card.cardImage || '';
        const hasImage = imageUrl && String(imageUrl).trim() !== '' && String(imageUrl).trim().startsWith('http');
        const status = String(card.status || '‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà').trim();
        const isSold = status !== '‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà' && status !== '' && status.toLowerCase() !== '‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà';
        
        let imageHtml = '';
        
        if (hasImage) {
          let cleanUrl = String(imageUrl).trim().replace(/^["']|["']$/g, '');
          
          if (cleanUrl.startsWith('http://') || cleanUrl.startsWith('https://')) {
            imageHtml = `<div class="card-image-placeholder" data-image-url="${escapeHtml(cleanUrl)}" data-card-index="${index}">
              <div class="image-loading-spinner"></div>
            </div>`;
          } else {
            imageHtml = '<div class="card-image-placeholder">üÉè</div>';
          }
        } else {
          imageHtml = '<div class="card-image-placeholder">üÉè</div>';
        }
        
        const price = card.listedPrice ? String(card.listedPrice) : '-';
        const folderSlot = card.folderSlot ? `‡∏ä‡πà‡∏≠‡∏á ${card.folderSlot}` : '-';
        const postedDate = card.postedDate || '-';
        const soldClass = isSold ? ' sold' : '';
        const statusText = isSold ? '‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß' : '‚úì ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà';
        const statusBadgeClass = isSold ? ' sold' : '';
        
        html += `
          <div class="card-item${soldClass}" onclick="openModal(${index})">
            <div class="card-image-container">
              ${imageHtml}
            </div>
            <div class="card-info">
              <div class="card-name">${escapeHtml(card.cardName)}</div>
              <div class="card-price">
                ${escapeHtml(price)} <span class="card-price-label">‡∏ö‡∏≤‡∏ó</span>
              </div>
              <div class="card-details">
                <div class="card-detail-row">
                  <span class="card-detail-label">‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏ô‡πÅ‡∏ü‡πâ‡∏°:</span>
                  <span class="card-detail-value">${escapeHtml(folderSlot)}</span>
                </div>
                <div class="card-detail-row">
                  <span class="card-detail-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á:</span>
                  <span class="card-detail-value">${escapeHtml(postedDate)}</span>
                </div>
                ${card.notes ? `
                <div class="card-detail-row">
                  <span class="card-detail-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span>
                  <span class="card-detail-value">${escapeHtml(card.notes)}</span>
                </div>
                ` : ''}
                <span class="status-badge${statusBadgeClass}">${escapeHtml(statusText)}</span>
              </div>
            </div>
          </div>
        `;
      });
      
      html += '</div>';
      container.innerHTML = html;
      
      window.currentFilteredCards = cards;
      loadImagesProgressively();
    }
    
    function loadImagesProgressively() {
      const imagePlaceholders = document.querySelectorAll('.card-image-placeholder[data-image-url]');
      
      if (imagePlaceholders.length === 0) return;
      
      let loadedCount = 0;
      let currentIndex = 0;
      
      function loadNextImage() {
        if (currentIndex >= imagePlaceholders.length) {
          return;
        }
        
        const placeholder = imagePlaceholders[currentIndex];
        const imageUrl = placeholder.getAttribute('data-image-url');
        currentIndex++;
        
        if (!imageUrl) {
          loadNextImage();
          return;
        }
        
        const img = new Image();
        
        // ‡πÅ‡∏õ‡∏•‡∏á Google Drive thumbnail URL ‡πÄ‡∏õ‡πá‡∏ô lh3.googleusercontent.com format
        let finalImageUrl = imageUrl;
        
        if (imageUrl.includes('drive.google.com/thumbnail')) {
          const fileIdMatch = imageUrl.match(/id=([a-zA-Z0-9_-]+)/);
          if (fileIdMatch && fileIdMatch[1]) {
            // ‡πÉ‡∏ä‡πâ lh3.googleusercontent.com ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (Google Drive thumbnail redirect ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà)
            finalImageUrl = `https://lh3.googleusercontent.com/d/${fileIdMatch[1]}=w1000`;
          }
        } else if (imageUrl.includes('drive.google.com') && !imageUrl.includes('lh3.googleusercontent.com')) {
          const fileIdMatch = imageUrl.match(/id=([a-zA-Z0-9_-]+)/);
          if (fileIdMatch && fileIdMatch[1]) {
            // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô lh3.googleusercontent.com format
            finalImageUrl = `https://lh3.googleusercontent.com/d/${fileIdMatch[1]}=w1000`;
          }
        }
        
        img.onload = function() {
          placeholder.innerHTML = '';
          placeholder.classList.remove('card-image-placeholder');
          placeholder.classList.add('card-image-container');
          img.className = 'card-image';
          img.alt = 'Card image';
          img.loading = 'lazy';
          placeholder.appendChild(img);
          
          const cardItem = placeholder.closest('.card-item');
          if (cardItem && cardItem.classList.contains('sold')) {
            // CSS ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ grayscale ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
          }
          
          loadedCount++;
          setTimeout(loadNextImage, 100);
        };
        
        img.onerror = function() {
          console.error('Failed to load image:', finalImageUrl);
          placeholder.innerHTML = '<div class="card-image-placeholder">üÉè</div>';
          placeholder.removeAttribute('data-image-url');
          loadedCount++;
          setTimeout(loadNextImage, 50);
        };
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° referrerPolicy ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô
        img.referrerPolicy = 'no-referrer';
        img.src = finalImageUrl;
      }
      
      loadNextImage();
    }

    function updateStats(total, filtered) {
      const statsEl = document.getElementById('stats');
      if (filtered === total) {
        statsEl.textContent = `‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${total} ‡∏Å‡∏≤‡∏£‡πå‡∏î`;
      } else {
        statsEl.textContent = `‡πÅ‡∏™‡∏î‡∏á ${filtered} ‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${total} ‡∏Å‡∏≤‡∏£‡πå‡∏î`;
      }
    }

    function updateDisplay() {
      const searchTerm = document.getElementById('search-box').value;
      const sortBy = document.getElementById('sort-select').value;
      
      filteredCards = filterCards(allCards, searchTerm);
      filteredCards = sortCards(filteredCards, sortBy);
      
      renderCards(filteredCards);
      updateStats(allCards.length, filteredCards.length);
    }

    function showSkeletonCards() {
      const container = document.getElementById('cards-container');
      let html = '<div class="cards-grid">';
      
      for (let i = 0; i < 9; i++) {
        html += `
          <div class="card-item skeleton-card" style="cursor: default; pointer-events: none;">
            <div class="card-image-container">
              <div class="skeleton-image"></div>
            </div>
            <div class="card-info">
              <div class="skeleton-text medium"></div>
              <div class="skeleton-text short" style="margin-top: 12px;"></div>
              <div class="skeleton-text" style="margin-top: 16px;"></div>
              <div class="skeleton-text" style="margin-top: 8px;"></div>
            </div>
          </div>
        `;
      }
      
      html += '</div>';
      container.innerHTML = html;
    }

    function loadCards() {
      const container = document.getElementById('cards-container');
      if (!container) return;
      
      showSkeletonCards();
      
      if (API_URL.includes('YOUR_APPS_SCRIPT_WEB_APP_URL')) {
        container.innerHTML = `
          <div class="error-message">
            <h3>‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API URL</h3>
            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ deploy Apps Script ‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà URL ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå card-shop.html</p>
          </div>
        `;
        return;
      }
      
      fetch(API_URL)
        .then(res => {
          if (!res.ok) {
            if (res.status === 429) {
              throw new Error('429: ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ö‡πà‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö');
            }
            throw new Error(`HTTP ${res.status}: ${res.statusText}`);
          }
          return res.json();
        })
        .then(data => {
          if (data.error) {
            container.innerHTML = `<div class="error-message">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${escapeHtml(data.error)}</div>`;
            return;
          }
          
          allCards = data.cards || [];
          renderCards(allCards);
          updateStats(allCards.length, allCards.length);
        })
        .catch(err => {
          console.error('Error loading cards:', err);
          const errorMessage = err.message || err.toString();
          let displayMessage = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
          
          if (errorMessage.includes('429')) {
            displayMessage = '‚ö†Ô∏è ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ö‡πà‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö (F5)';
          } else if (errorMessage.includes('CORS')) {
            displayMessage = '‚ö†Ô∏è ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ú‡πà‡∏≤‡∏ô web server ‡∏´‡∏£‡∏∑‡∏≠ deploy Apps Script ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
          } else if (errorMessage.includes('Failed to fetch')) {
            displayMessage = '‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö API ‡πÑ‡∏î‡πâ<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï';
          } else {
            displayMessage += `<br>${escapeHtml(errorMessage)}`;
          }
          
          container.innerHTML = `
            <div class="error-message">
              ${displayMessage}
            </div>
          `;
        });
    }

    function openModal(cardIndex) {
      const cards = window.currentFilteredCards || [];
      const card = cards[cardIndex];
      if (!card) return;
      
      const modal = document.getElementById('imageModal');
      const frontImage = document.getElementById('modal-front-image');
      const backImage = document.getElementById('modal-back-image');
      
      const status = card.status || '‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà';
      const isSold = status !== '‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà';
      
      if (isSold) {
        modal.classList.add('sold');
      } else {
        modal.classList.remove('sold');
      }
      
      document.getElementById('modal-card-name').textContent = card.cardName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠';
      
      if (card.cardImage) {
        frontImage.src = card.cardImage;
        frontImage.style.display = 'block';
        frontImage.nextElementSibling.style.display = 'none';
      } else {
        frontImage.style.display = 'none';
        frontImage.nextElementSibling.style.display = 'block';
      }
      
      if (card.cardBackImage) {
        backImage.src = card.cardBackImage;
        backImage.style.display = 'block';
        backImage.nextElementSibling.style.display = 'none';
      } else {
        backImage.style.display = 'none';
        backImage.nextElementSibling.style.display = 'block';
      }
      
      const price = card.listedPrice ? String(card.listedPrice) + ' ‡∏ö‡∏≤‡∏ó' : '-';
      document.getElementById('modal-price').textContent = price;
      
      const folderSlot = card.folderSlot ? `‡∏ä‡πà‡∏≠‡∏á ${card.folderSlot}` : '-';
      document.getElementById('modal-folder-slot').textContent = folderSlot;
      
      document.getElementById('modal-posted-date').textContent = card.postedDate || '-';
      
      const statusText = isSold ? '‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß' : '‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà';
      const statusElement = document.getElementById('modal-status');
      statusElement.textContent = statusText;
      statusElement.style.color = isSold ? '#e53935' : '#4caf50';
      statusElement.style.fontWeight = 'bold';
      
      if (card.notes) {
        document.getElementById('modal-notes').textContent = card.notes;
        document.getElementById('modal-notes-row').style.display = 'flex';
      } else {
        document.getElementById('modal-notes-row').style.display = 'none';
      }
      
      modal.style.display = 'block';
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      const modal = document.getElementById('imageModal');
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
    }

    window.onclick = function(event) {
      const modal = document.getElementById('imageModal');
      if (event.target === modal) {
        closeModal();
      }
    }

    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeModal();
      }
    });

    document.getElementById('search-box').addEventListener('input', updateDisplay);
    document.getElementById('sort-select').addEventListener('change', updateDisplay);

    window.addEventListener('DOMContentLoaded', loadCards);
  </script>

  <!-- Contact & Social Quick Actions (Footer) -->
  <footer style="margin-top:40px; padding: 24px 0 12px 0; background: #f7f8fa; border-top: 1.5px solid #e0e7ff;">
    <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 18px;">
      <a href="https://maps.app.goo.gl/4Lk4CnLN9bKoVW7y6" target="_blank" style="text-decoration:none;">
        <button style="display:flex;align-items:center;gap:8px;padding:12px 20px;font-size:1.1em;background:#2563eb;color:#fff;border:none;border-radius:8px;box-shadow:0 2px 8px #b6c0d1;cursor:pointer;">
          üó∫Ô∏è <span>‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô</span>
        </button>
      </a>
      <a href="https://www.facebook.com/uplevel.acad" target="_blank" style="text-decoration:none;">
        <button style="display:flex;align-items:center;gap:8px;padding:12px 20px;font-size:1.1em;background:#1877f2;color:#fff;border:none;border-radius:8px;box-shadow:0 2px 8px #b6c0d1;cursor:pointer;">
          üëç <span>‡∏î‡∏π‡πÄ‡∏û‡∏à Facebook</span>
        </button>
      </a>
      <a href="https://line.me/ti/g2/uGTOOvPJuCjaxW_ZlJyjroEU7zOqLuBaWw9UaQ?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" target="_blank" style="text-decoration:none;">
        <button style="display:flex;align-items:center;gap:8px;padding:12px 20px;font-size:1.1em;background:#06c755;color:#fff;border:none;border-radius:8px;box-shadow:0 2px 8px #b6c0d1;cursor:pointer;">
          üí¨ <span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° LINE OpenChat</span>
        </button>
      </a>
    </div>
    <div style="text-align:center;color:#888;font-size:0.98em;margin-top:18px;">
      Up Level Academy | ‡∏ï‡∏¥‡∏î MRT ‡∏ö‡∏≤‡∏á‡πÅ‡∏Ñ | ‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏™‡∏∞‡∏î‡∏ß‡∏Å
    </div>
  </footer>
</body>
</html>

