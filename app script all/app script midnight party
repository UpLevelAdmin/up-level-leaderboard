function doGet() {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Form Responses 1');
  var data = sheet.getDataRange().getValues();
  var headers = data[0];
  var users = [];
  for (var i = 1; i < data.length; i++) {
    var row = data[i];
    var obj = {};
    for (var j = 0; j < headers.length; j++) {
      obj[headers[j]] = row[j];
    }
    users.push(obj);
  }
  return ContentService.createTextOutput(JSON.stringify({ users: users }))
    .setMimeType(ContentService.MimeType.JSON);
}

function getCodenameByPhone(phone) {
  try {
    // เปิด Google Sheet ของ codename mapping
    const codenameSheetId = 'YOUR_CODENAME_SHEET_ID'; // ใส่ ID ของ Sheet ที่มี codename mapping
    const sheet = SpreadsheetApp.openById(codenameSheetId);
    const worksheet = sheet.getSheetByName('Sheet1'); // หรือชื่อ sheet ที่มี codename
    
    if (!worksheet) {
      return null;
    }
    
    const data = worksheet.getDataRange().getValues();
    const headers = data[0];
    const rows = data.slice(1);
    
    // หา index ของ columns
    const phoneIndex = headers.indexOf('เบอร์โทรศัพท์'); // ปรับตามชื่อ column ใน sheet ของคุณ
    const codenameIndex = headers.indexOf('Codename'); // ปรับตามชื่อ column ใน sheet ของคุณ
    
    if (phoneIndex === -1 || codenameIndex === -1) {
      return null;
    }
    
    // ค้นหา codename จากเบอร์โทรศัพท์
    for (let row of rows) {
      if (row[phoneIndex] && row[phoneIndex].toString().trim() === phone.trim()) {
        return row[codenameIndex] ? row[codenameIndex].trim() : null;
      }
    }
    
    return null;
    
  } catch (error) {
    console.error('Error getting codename:', error);
    return null;
  }
}
