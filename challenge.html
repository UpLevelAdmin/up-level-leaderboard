
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢ | Up Level Guild</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f0f2f5;
      text-align: center;
      padding: 20px;
    }
    .challenge-card {
      background: white;
      border-radius: 10px;
      padding: 1rem;
      margin: 1rem auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 600px;
      text-align: left;
    }
    .button-primary {
      background-color: #4caf50;
      color: white;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border: none;
      border-radius: 5px;
      margin-top: 1rem;
      cursor: pointer;
    }
    .hidden { display: none; }
    form {
      margin-top: 1rem;
      padding: 1rem;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    label {
      display: block;
      text-align: left;
      margin: 0.5rem 0 0.2rem;
    }
    select, input[type="text"] {
      width: 100%;
      padding: 0.4rem;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <img src="https://i.postimg.cc/wjzpnxjB/Up-Level-01-1.png" alt="Up Level Guild" style="width: 150px; margin-bottom: 10px;" />
  <h1>üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢</h1>
  <div id="challenge-list">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

  <button id="show-form-btn" class="button-primary">+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤</button>

  <form id="challenge-form" class="hidden">
    <label>üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</label>
    <input type="text" id="phone" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ 10 ‡∏´‡∏•‡∏±‡∏Å" required />
    <button type="button" id="verify-btn" class="button-primary">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>

    <p id="codename-display" style="font-weight:bold;"></p>
    <div id="form-fields" class="hidden">
      <p>üí• ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤</p>
      <select id="type">
        <option value="open">Open Challenge</option>
        <option value="direct">Direct Challenge</option>
      </select>

      <div id="target-select-container" class="hidden">
        <label>üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ñ‡∏π‡∏Å‡∏ó‡πâ‡∏≤:</label>
        <select id="target"></select>
      </div>

      <label>‚öîÔ∏è ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á:</label>
      <select id="mode">
        <option value="Standard BO1">Standard BO1</option>
        <option value="Standard BO3">Standard BO3</option>
        <option value="Standard BO5">Standard BO5</option>
        <option value="Asia Wide">Asia Wide</option>
      </select>

      <label>üéÅ ‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô / ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç:</label>
      <input type="text" id="wager" placeholder="‡πÄ‡∏ä‡πà‡∏ô EXP 1, ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ô‡πâ‡∏≥, ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏°" />

      <label>üìù ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠):</label>
      <input type="text" id="title" placeholder="‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏∞‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ" />

      <button type="submit" class="button-primary">‚ú® ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
    </div>
  </form>

  <p>üì≤ ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤: 
    <a href="https://www.facebook.com/uplevelacademy" target="_blank">Facebook Page</a> | 
    <a href="https://lin.ee/qlM5nVG" target="_blank">LINE Official</a></p>

  <script>
    const endpoint = "https://script.google.com/macros/s/AKfycbwJoXR9EFLngOAyA_WjQJNE0zT3MmL2afwlwvxmnMQ88WYzjlD-l2c_LXjg-k3bFWj9/exec";
    const listDiv = document.getElementById("challenge-list");
    const form = document.getElementById("challenge-form");
    const showFormBtn = document.getElementById("show-form-btn");
    const formFields = document.getElementById("form-fields");

    let myCodename = "";

    showFormBtn.onclick = () => form.classList.toggle("hidden");

    document.getElementById("verify-btn").addEventListener("click", async () => {
      let phone = document.getElementById("phone").value.trim();
      if (phone.length === 9 && !phone.startsWith("0")) phone = "0" + phone;

      const res = await fetch(endpoint + "?func=getCodename&phone=" + phone);
      myCodename = await res.text();
      document.getElementById("codename-display").innerText = `üîé Codename ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: ${myCodename}`;
      formFields.classList.remove("hidden");

      const resNames = await fetch(endpoint + "?func=getCodenameList");
      const names = await resNames.json();
      const targetSelect = document.getElementById("target");
      const filtered = names.filter(name => name.trim().toLowerCase() !== myCodename.trim().toLowerCase());
      targetSelect.innerHTML = filtered.length > 0
        ? filtered.map(name => `<option value="${name}">${name}</option>`).join("")
        : `<option disabled selected>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏∑‡πà‡∏ô</option>`;
    });

    document.getElementById("type").onchange = e => {
      const showTarget = e.target.value === "direct";
      document.getElementById("target-select-container").classList.toggle("hidden", !showTarget);
    };

    form.onsubmit = async (e) => {
      e.preventDefault();
      const phone = document.getElementById("phone").value.trim();
      const type = document.getElementById("type").value;
      const type = document.getElementById("type").value;
      const target = type === "direct" ? document.getElementById("target").value : "";
      const mode = document.getElementById("mode").value;
      const wager = document.getElementById("wager").value;
      const title = document.getElementById("title").value;

      try {
        const res = await fetch(endpoint + "?func=submitChallengeRequest", {
          method: "POST",
          body: JSON.stringify({ phone, type, target, mode, wager, title })
        });
        const text = await res.text();
        alert(text);
        form.reset();
        location.reload();
      } catch {
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
      }
    };

    async function loadChallenges() {
      listDiv.innerHTML = "üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤...";
      try {
        const res = await fetch(endpoint + "?func=getChallengeList");
        const all = await res.json();
        const approved = all.filter(row => row["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤"] === "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥");

        if (approved.length === 0) {
          listDiv.innerHTML = "<p>üì≠ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢<br>‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!</p>";
        } else {
          listDiv.innerHTML = "";
          for (let row of approved) {
            const card = document.createElement("div");
            card.className = "challenge-card";
            card.innerHTML = `
              <p>üëë <b>${row["Codename"]}</b></p>
              <p>üí• ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${row["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"]}</p>
              <p>üéÆ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ${row["‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö"]}</p>
              <p>üéÅ ‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô: ${row["‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô"]}</p>
              <p>üìù ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤: ${row["‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤"]}</p>
            `;
            listDiv.appendChild(card);
          }
        }
      } catch {
        listDiv.innerHTML = "<p>‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤‡πÑ‡∏î‡πâ</p>";
      }
    }

    loadChallenges();
  </script>
</body>
</html>
