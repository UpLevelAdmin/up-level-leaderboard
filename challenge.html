<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>р╕кр╕гр╣Йр╕▓р╕Зр╕Др╕│р╕Чр╣Йр╕▓ | Up Level Guild</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="form-container">
    <h2>р╕кр╕гр╣Йр╕▓р╕Зр╕Бр╕▓р╕гр╕Чр╣Йр╕▓р╣Бр╕Вр╣Ир╕З</h2>
    <label for="phone">ЁЯУ▒ р╣Ар╕Ър╕нр╕гр╣Мр╣Вр╕Чр╕г</label>
    <input type="tel" id="phone" placeholder="08XXXXXXXX">
    <button onclick="lookupCodename()">р╕Хр╕гр╕зр╕И Codename</button>

    <div id="codename-area" style="display:none;">
      <p><strong>р╕гр╕лр╕▒р╕к Codename:</strong> <span id="codename"></span></p>

      <label for="type">ЁЯПЦя╕П р╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Др╕│р╕Чр╣Йр╕▓</label>
      <select id="type" onchange="toggleTargetSelect()">
        <option value="open">ЁЯФУ Open Challenge</option>
        <option value="direct">ЁЯОп Direct Challenge</option>
      </select>

      <div id="target-area" style="display:none;">
        <label for="target">ЁЯСд р╕Ьр╕╣р╣Йр╕Цр╕╣р╕Бр╕Чр╣Йр╕▓</label>
        <select id="target"></select>
      </div>

      <label for="mode">ЁЯПА р╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Бр╕▓р╕гр╣Бр╕Вр╣Ир╕З</label>
      <select id="mode">
        <option>Standard BO1</option>
        <option>Standard BO3</option>
        <option>Standard BO5</option>
        <option>Asia Wide</option>
      </select>

      <label for="wager">тЪЦя╕П р╣Ар╕Фр╕┤р╕бр╕Юр╕▒р╕Щ / р╣Ар╕гр╕╖р╣Ир╕нр╕вр╣Ар╕Бр╕┤р╕Щ</label>
      <textarea id="wager" rows="2" placeholder="р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Кр╣Ир╕Щ: р╣Ар╕ер╕╡р╣Йр╕вр╕Зр╕Щр╣Йр╕│ / EXP 5 / р╣Вр╕Юр╕кр╕Хр╣Мр╕вр╕нр╕бр╕гр╕▒р╕Ър╕Др╕зр╕▓р╕бр╕Юр╣Ир╕▓р╕вр╣Бр╕Юр╣Й"></textarea>

      <label for="title">ЁЯУЦ р╕Хр╕▒р╣Йр╕Зр╕Кр╕╖р╣Ир╕нр╕Др╕│р╕Чр╣Йр╕▓ (р╕Цр╣Йр╕▓р╕зр╣Ир╕▓р╕Зр╕Ир╕░р╕кр╕╕р╣Ир╕бр╣Гр╕лр╣Й)</label>
      <input id="title" placeholder="р╣Ар╕Кр╣Ир╕Щ р╕ир╕╢р╕Бр╕кр╕▓р╕вр╣Ар╕ер╕╖р╕нр╕Ф...">

      <button onclick="submitChallenge()">р╕кр╣Ир╕Зр╕Др╕│р╕Чр╣Йр╕▓р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ</button>
    </div>
  </div>

  <p style="text-align:center; margin-top:2rem; font-size:0.9rem;">
    тЬи р╕кр╣Ир╕Зр╣Бр╕ер╣Йр╕зр╣Бр╕Ир╣Йр╕Зр╣Бр╕нр╕Фр╕бр╕┤р╕Щ р╕Чр╕╡р╣И:
    <a href="https://m.me/uplevel.acad" target="_blank">Facebook Page</a> |
    <a href="https://lin.ee/YT87E65" target="_blank">LINE Official</a>
  </p>

  <script>
    const scriptId = 'AKfycbwJoXR9EFLngOAyA_WjQJNE0zT3MmL2afwlwvxmnMQ88WYzjlD-l2c_LXjg-k3bFWj9';

    function lookupCodename() {
      const phone = document.getElementById('phone').value.trim();
      if (!phone.match(/^0\d{9}$/)) return alert("р╣Ар╕Ър╕нр╕гр╣Мр╣Вр╕Чр╕гр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З");
      fetch(`https://script.google.com/macros/s/${scriptId}/exec?func=getCodename&phone=${phone}`)
        .then(res => res.text())
        .then(name => {
          if (name === "р╣Др╕бр╣Ир╕Юр╕Ър╕Кр╕╖р╣Ир╕н") return alert("р╣Др╕бр╣Ир╕Юр╕Ър╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Щр╕╡р╣Й");
          document.getElementById('codename').innerText = name;
          document.getElementById('codename-area').style.display = 'block';
          fetch(`https://script.google.com/macros/s/${scriptId}/exec?func=getCodenameList`)
            .then(res => res.json())
            .then(data => {
              const select = document.getElementById('target');
              select.innerHTML = '';
              data.forEach(name => {
                const opt = document.createElement('option');
                opt.value = name;
                opt.textContent = name;
                select.appendChild(opt);
              });
            });
        });
    }

    function toggleTargetSelect() {
      const type = document.getElementById('type').value;
      document.getElementById('target-area').style.display = (type === 'direct') ? 'block' : 'none';
    }

    function submitChallenge() {
      const phone = document.getElementById('phone').value.trim();
      const type = document.getElementById('type').value;
      const target = document.getElementById('target').value || '';
      const mode = document.getElementById('mode').value;
      const wager = document.getElementById('wager').value.trim();
      let title = document.getElementById('title').value.trim();
      if (!title) {
        const codename = document.getElementById('codename').innerText;
        const formats = [
          "р╕ир╕╢р╕Бр╕Вр╕нр╕З %s р╕Бр╕▒р╕Ър╣Вр╕Кр╕Др╕Кр╕░р╕Хр╕▓", "%s р╕нр╕вр╕▓р╕Бр╕зр╕▒р╕Фр╕Эр╕╡р╕бр╕╖р╕н", "%s р╕Ир╕░р╣Др╕бр╣Ир╕Чр╕Щр╣Бр╕ер╣Йр╕з!", "%s р╕Вр╕нр╕Чр╣Йр╕▓р╕Чр╕╕р╕Бр╕Др╕Щ!",
          "р╕кр╕Щр╕▓р╕бр╕Ыр╕гр╕░р╕ер╕нр╕Зр╕Вр╕нр╕З %s", "%s р╕Ыр╕гр╕░р╕Бр╕▓р╕ир╕ир╕▒р╕Бр╕Фр╕▓", "р╕ар╕▓р╕гр╕Бр╕┤р╕Ир╕ер╣Йр╕▓р╕Зр╣Бр╕Др╣Йр╕Щр╕Вр╕нр╕З %s", "%s Challenge!",
          "%s vs ???", "р╕Цр╕╢р╕Зр╣Ар╕зр╕ер╕▓р╣Вр╕Кр╕зр╣Мр╕Вр╕нр╕Зр╕Вр╕нр╕З %s", "р╕ир╕╢р╕Бр╕Бр╕ер╕▓р╕Зр╕Др╕ер╕▒р╕Ър╣Вр╕Фр╕в %s", "%s р╕Вр╕нр╕кр╕╣р╣Йр╕Фр╣Йр╕зр╕вр╕ир╕▒р╕Бр╕Фр╕┤р╣Мр╕ир╕гр╕╡",
          "%s р╕нр╕вр╕▓р╕Бр╕гр╕╣р╣Йр╕зр╣Ир╕▓р╣Гр╕Др╕гр╣Бр╕Щр╣Ир╕Ир╕гр╕┤р╕З", "%s р╣Ар╕Ыр╕┤р╕Фр╕кр╕Щр╕▓р╕бр╕Чр╣Йр╕▓", "%s р╕Ыр╕░р╕Чр╕░р╣Вр╕Кр╕Др╕Кр╕░р╕Хр╕▓", "%s р╕зр╕▒р╕Фр╕Фр╕зр╕З!",
          "р╕бр╕▓р╕Фр╕╣р╕Бр╕▒р╕Щр╕зр╣Ир╕▓р╣Гр╕Др╕гр╣Бр╕Щр╣Ир╕Бр╕зр╣Ир╕▓ %s", "%s VS р╣Вр╕ер╕Бр╕Чр╕▒р╣Йр╕Зр╣Гр╕Ъ", "р╕ар╕▓р╕гр╕Бр╕┤р╕Ир╕ер╕▒р╕Ър╕Вр╕нр╕З %s", "%s р╕ер╕╕р╕вр╣Бр╕ер╣Йр╕з!"
        ];
        const format = formats[Math.floor(Math.random() * formats.length)];
        title = format.replace('%s', codename);
      }
      fetch(`https://script.google.com/macros/s/${scriptId}/exec?func=submitChallengeRequest`, {
        method: 'POST',
        body: JSON.stringify({ phone, type, target, mode, wager, title }),
        headers: { 'Content-Type': 'application/json' }
      })
        .then(res => res.text())
        .then(msg => alert(msg))
        .catch(() => alert("р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф"));
    }
  </script>
</body>
</html>
