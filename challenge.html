<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢ | Up Level Guild</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f2f2f2;
      text-align: center;
      padding: 20px;
    }
    .logo {
      width: 120px;
      margin-bottom: 10px;
    }
    h2 {
      font-size: 24px;
      margin-bottom: 10px;
    }
    .challenge-box {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    select, input, textarea {
      width: 90%;
      padding: 8px;
      margin: 8px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .challenge-item {
      background: #fafafa;
      margin: 10px auto;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
      text-align: left;
      max-width: 500px;
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <img src="https://i.ibb.co/WFyzmdr/uplogo.png" class="logo" />
  <h2>üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢</h2>
  <div id="challenge-list">
    <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
  </div>
  <button onclick="toggleForm()">+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤</button>
  <div id="challenge-form" class="challenge-box hidden">
    <h3>üßô‚Äç‚ôÇÔ∏è ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
    <input id="phone" placeholder="üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:" />
    <button id="verify-btn">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
    <p id="codename-display" style="margin-top:10px; font-weight:bold;"></p>
    <div id="form-fields" class="hidden">
      <select id="type">
        <option value="open">Open Challenge</option>
        <option value="direct">Direct Challenge</option>
      </select>
      <select id="target"></select>
      <select id="mode">
        <option>Standard BO1</option>
        <option>Standard BO3</option>
        <option>Standard BO5</option>
        <option>Asia Wide</option>
      </select>
      <input id="wager" placeholder="üéØ ‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô / ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (‡πÄ‡∏ä‡πà‡∏ô EXP 1, ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ô‡πâ‡∏≥, ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏°)" />
      <input id="title" placeholder="üìù ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠):" />
      <button onclick="submitChallenge()">‚ú® ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
    </div>
    <p style="margin-top:10px;">üì≤ ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤: 
      <a href="https://facebook.com/uplevelacademy" target="_blank">Facebook Page</a> |
      <a href="https://lin.ee/yourlineoa" target="_blank">LINE Official</a>
    </p>
  </div>
<script>
const endpoint = "https://script.google.com/macros/s/AKfycbwJoXR9EFLngOAyA_WjQJNE0zT3MmL2afwlwvxmnMQ88WYzjlD-l2c_LXjg-k3bFWj9/exec";

let myCodename = "";

function toggleForm() {
  document.getElementById("challenge-form").classList.toggle("hidden");
}

document.getElementById("verify-btn").addEventListener("click", async () => {
  let phone = document.getElementById("phone").value.trim();
  if (phone.length === 9 && !phone.startsWith("0")) phone = "0" + phone;
  const res = await fetch(endpoint + "?func=getCodename&phone=" + phone);
  myCodename = await res.text();
  document.getElementById("codename-display").innerText = `üîé Codename ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: ${myCodename}`;
  formFields.classList.remove("hidden");

  const resNames = await fetch(endpoint + "?func=getCodenameList");
  const names = await resNames.json();
  const targetSelect = document.getElementById("target");
  const filtered = names.filter(name => name.trim().toLowerCase() !== myCodename.trim().toLowerCase());
  targetSelect.innerHTML = filtered.map(name => `<option value="${name}">${name}</option>`).join("");
});

async function submitChallenge() {
  const payload = {
    phone: document.getElementById("phone").value.trim(),
    type: document.getElementById("type").value,
    target: document.getElementById("type").value === "direct" ? document.getElementById("target").value : "",
    mode: document.getElementById("mode").value,
    wager: document.getElementById("wager").value.trim(),
    title: document.getElementById("title").value.trim()
  };
  const res = await fetch(endpoint + "?func=submitChallengeRequest", {
    method: "POST",
    body: JSON.stringify(payload)
  });
  const msg = await res.text();
  alert(msg);
  location.reload();
}

async function loadChallengeBoard() {
  const res = await fetch(endpoint + "?func=getChallengeList");
  const data = await res.json();
  const listDiv = document.getElementById("challenge-list");
  if (data.length === 0) {
    listDiv.innerHTML = "<p>üì£ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>";
    return;
  }
  listDiv.innerHTML = "";
  data.forEach(c => {
    const div = document.createElement("div");
    div.className = "challenge-item";
    div.innerHTML = `
      üßô‚Äç‚ôÇÔ∏è ${c.Codename} (${c.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó})<br>
      üéØ ${c.‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤}<br>
      ‚ú® ${c.‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô}<br>
      ‚öîÔ∏è ${c.‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö}
    `;
    listDiv.appendChild(div);
  });
}
window.onload = loadChallengeBoard;
</script>
</body>
</html>