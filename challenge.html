<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢ | Up Level Guild</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f0f2f5;
      text-align: center;
      padding: 20px;
      margin: 0;
    }

    h1 {
      margin-bottom: 20px;
    }

    img.logo {
      width: 150px;
      margin-bottom: 10px;
    }

    .challenge-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: white;
      border-radius: 10px;
      padding: 0.75rem;
      margin: 0.75rem auto;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
      max-width: 600px;
      font-size: 0.95rem;
      flex-wrap: wrap;
    }

   

    .duel-ready {
      font-weight: bold;
      color: red;
      font-size: 1rem;
    }

    .challenge-type {
      font-weight: bold;
      padding: 2px 6px;
      border-radius: 6px;
      color: white;
      margin-right: 10px;
      font-size: 0.75rem;
      line-height: 1;
    }

    .challenge-type.open { background: #007bff; }
    .challenge-type.direct { background: #ff4136; }

    .challenge-main {
      flex-grow: 1;
      margin: 5px 0;
      text-align: left;
      min-width: 200px;
    }

    .challenge-actions {
      display: flex;
      align-items: center;
      gap: 5px;
      justify-content: flex-end;
      width: 100%;
      margin-top: 10px;
    }

    .button-create {
      background-color: #3f51b5;
      color: white;
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 0 8px 8px 0;
      display: inline-block;
    }

    .button-create.trainer {
      background-color: #2196f3;
    }

    .button-create.party {
      background-color: #43a047;
    }

    .button-verify {
      background-color: #00bcd4;
      color: white;
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 8px;
    }

    .button-submit {
      background-color: #4caf50;
      color: white;
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 1rem;
    }

    .button-accept {
      background-color: #ff9800;
      color: white;
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 1rem;
    }

    .button-secondary {
      background: none;
      border: none;
      color: #007bff;
      cursor: pointer;
      padding: 0;
      font-size: 0.8rem;
      margin-top: 4px;
    }

    .detail-section {
      width: 100%;
      padding: 0.5rem;
      background: #f9f9f9;
      border-radius: 8px;
      margin-top: 0.5rem;
      font-size: 0.85rem;
      display: none;
    }

    .hidden {
      display: none !important;
    }

    form {
      max-width: 600px;
      margin: 1rem auto;
      padding: 1rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      text-align: left;
    }

    form.hidden {
      display: none;
    }

    form label {
      display: block;
      margin-top: 0.75rem;
      font-size: 0.9rem;
    }

    form input, form select {
      width: 100%;
      padding: 0.4rem;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-top: 0.25rem;
    }
 .challenge-card.ready {
      border-left: 5px solid #ff0000;
      background: linear-gradient(135deg, #ffe5e5 0%, #ffcccc 100%);
      animation: readyPulse 1.5s ease-in-out infinite;
      position: relative;
      overflow: hidden;
    }

    .challenge-card.ready::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes readyPulse {
      0% { 
        box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7);
        transform: scale(1);
      }
      50% { 
        box-shadow: 0 0 0 15px rgba(255, 0, 0, 0.3);
        transform: scale(1.02);
      }
      100% { 
        box-shadow: 0 0 0 0 rgba(255, 0, 0, 0);
        transform: scale(1);
      }
    }

    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    @media (max-width: 480px) {
      .challenge-card {
        flex-direction: column;
        align-items: flex-start;
      }

      .challenge-main {
        width: 100%;
        text-align: left;
      }

      .challenge-actions {
        width: 100%;
        justify-content: flex-end;
        margin-top: 0.5rem;
      }

      .button-create, .button-verify, .button-submit, .button-accept, .button-secondary {
        font-size: 0.95rem;
        width: 100%;
      }

      .button-create {
        display: block;
        width: 100%;
        margin: 0 0 10px 0;
      }
    }
  </style>
</head>
<body>
  <img src="https://i.postimg.cc/wjzpnxjB/Up-Level-01-1.png" alt="Up Level Guild" class="logo" />
  <h1>üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢</h1>

  <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤ -->
  <div id="challenge-list">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏¢‡∏Å -->
  <button id="show-trainer-form-btn" class="button-create trainer">+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏ó‡∏£‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå</button>
  <button id="show-party-auth-btn" class="button-create party">+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ</button>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏ó‡∏£‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå (trainer challenge) -->
  <form id="challenge-form" class="hidden">
    <label>üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</label>
    <input type="text" id="phone" pattern="\d*" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ 10 ‡∏´‡∏•‡∏±‡∏Å" required />
    <button type="button" id="verify-btn" class="button-verify">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>

    <p id="codename-display" style="font-weight:bold;"></p>

    <div id="form-fields" class="hidden">
      <label>üí• ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤</label>
      <select id="type">
        <option value="open">Open Challenge</option>
        <option value="direct">Direct Challenge</option>
        <option value="party">Party vs Party</option>
      </select>

      <div id="target-select-container" class="hidden">
        <label>üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ñ‡∏π‡∏Å‡∏ó‡πâ‡∏≤:</label>
        <select id="target"></select>
      </div>

      <div id="party-select-container" class="hidden">
        <label>üõ°Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ó‡πâ‡∏≤:</label>
        <select id="party-target"></select>
      </div>

      <label>‚öîÔ∏è ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á:</label>
      <select id="mode">
        <option value="Standard BO1">Standard BO1</option>
        <option value="Standard BO3">Standard BO3</option>
        <option value="Standard BO5">Standard BO5</option>
        <option value="Asia Wide BO1">Asia Wide BO1</option>
        <option value="Asia Wide BO3">Asia Wide BO3</option>
        <option value="Asia Wide BO5">Asia Wide BO5</option>
      </select>

      <label>üéÅ ‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô / ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç:</label>
      <input type="text" id="wager" placeholder="‡πÄ‡∏ä‡πà‡∏ô EXP 1, ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ô‡πâ‡∏≥, ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏°" />

      <label>üìù ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠):</label>
      <input type="text" id="title" placeholder="‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏∞‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ" />

      <button type="submit" class="button-submit">‚ú® ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
    </div>
  </form>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ -->
  <form id="party-auth-form" class="hidden">
    <label>üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ:</label>
    <input type="text" id="party-leader-phone" pattern="\d*" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ 10 ‡∏´‡∏•‡∏±‡∏Å" required />
    <label>üë§ ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ:</label>
    <input type="text" id="party-leader-fullname" placeholder="‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô" required />
    <button type="button" id="verify-party-leader-btn" class="button-verify">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
  </form>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤ Party vs Party -->
  <form id="party-challenge-form" class="hidden">
    <div id="my-party-info" style="margin-bottom:10px;color:#3f51b5;"></div>
    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:</label>
    <select id="party-size">
      <option value="2v2">2v2</option>
      <option value="3v3">3v3</option>
      <option value="4v4">4v4</option>
      <option value="5v5">5v5</option>
    </select>
    <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</label>
    <select id="party-type">
      <option value="Standard">Standard</option>
      <option value="Asia Wide">Asia Wide</option>
    </select>
    <label>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:</label>
    <select id="party-mode">
      <option value="BO1">BO1</option>
      <option value="BO3">BO3</option>
      <option value="BO5">BO5</option>
    </select>
    <label>üõ°Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ó‡πâ‡∏≤:</label>
    <select id="party-target"></select>
    <label>üéÅ ‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô / ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç:</label>
    <input type="text" id="party-wager" placeholder="‡πÄ‡∏ä‡πà‡∏ô Party Point 5, ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏Ø‡∏•‡∏Ø" />
    <label>üìù ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠):</label>
    <input type="text" id="party-title" placeholder="‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏∞‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ" />
    <button type="submit" class="button-submit">‚ú® ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤ Party vs Party</button>
  </form>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤ -->
  <div id="accept-form" class="hidden">
    <form>
      <h3>‚úÖ ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤</h3>
      <label>üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</label>
      <input type="text" id="accept-phone" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ 10 ‡∏´‡∏•‡∏±‡∏Å" />

      <label>üë§ ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</label>
      <input type="text" id="accept-fullname" placeholder="‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô" />

      <input type="hidden" id="accept-id" />
      <input type="hidden" id="accept-type" />
      <input type="hidden" id="accept-target" />

      <button type="button" onclick="submitAccept()" class="button-accept">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤</button>
    </form>
  </div>

  <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ -->
  <p>üì≤ ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤:
    <a href="https://www.facebook.com/uplevelacademy" target="_blank">Facebook Page</a> |
    <a href="https://lin.ee/qlM5nVG" target="_blank">LINE Official</a>
  </p>
<script>
  const endpoint = "https://script.google.com/macros/s/AKfycbxtjsDwHI6nJU4OIHExUxMaZwUn3qwakvdkzwbQO7C8Trzz5Gh84SX6F1gqb4BOFQcn/exec";
  const listDiv = document.getElementById("challenge-list");

  const openPhrases = [
    "‡∏≠‡∏¢‡∏≤‡∏Å‡∏ß‡∏±‡∏î‡∏ù‡∏µ‡∏°‡∏∑‡∏≠‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ!",
    "‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏•‡πâ‡∏≤ ‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ ‡∏°‡∏≤‡∏™‡∏π‡πâ‡∏Å‡∏±‡∏ô!",
    "‡πÄ‡∏ö‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏î‡∏≠‡∏á ‡∏≠‡∏¢‡∏≤‡∏Å‡∏•‡∏≠‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≤‡∏•‡∏µ‡∏ô!",
    "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏•‡πâ‡∏≤‡∏£‡∏±‡∏ö!",
    "‡∏Ç‡∏≠‡∏ó‡πâ‡∏≤‡∏°‡∏≤‡∏î‡∏¥‡∏Ñ‡πâ‡∏≤‡∏ö ‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ!",
    "‡∏ó‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô ‡∏°‡∏≤‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏™‡∏¥!",
    "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏°‡∏±‡∏ô‡∏™‡πå‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô!",
    "‡∏≠‡∏¢‡∏≤‡∏Å‡∏î‡∏ß‡∏• ‡πÉ‡∏Ñ‡∏£‡πÅ‡∏ô‡πà‡πÜ ‡∏°‡∏≤‡∏î‡∏ß‡∏•‡∏´‡∏ô‡πà‡∏≠‡∏¢!",
    "‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏ô‡∏≤‡∏° ‡∏£‡∏≠‡∏ó‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà!",
    "‡∏≠‡∏¢‡∏≤‡∏Å‡∏ö‡∏ß‡∏Å‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ ‡∏°‡∏≤‡∏Ç‡∏≠‡πÅ‡∏Ñ‡πà‡πÉ‡∏à‡∏ñ‡∏∂‡∏á!",
    "‡∏Ç‡∏≠‡∏î‡∏ß‡∏•‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏Å‡∏•‡πâ‡∏≤‡∏™‡∏±‡∏Å‡∏Ñ‡∏ô!",
    "‡∏≠‡∏¢‡∏≤‡∏Å‡∏•‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏Ç‡πá‡∏á ‡∏°‡∏≤‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏î‡∏¥‡πä!",
    "‡πÄ‡∏ö‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏≠‡∏ô‡∏´‡∏°‡∏≠‡∏ô ‡∏≠‡∏¢‡∏≤‡∏Å‡∏ô‡∏≠‡∏ô ICU! ‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏î‡∏¥‡πä",
    "‡πÄ‡∏ö‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡πâ‡∏≥‡∏û‡∏£‡∏¥‡∏Å‡∏•‡∏á‡πÄ‡∏£‡∏∑‡∏≠ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏Å‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡πÇ‡∏£‡∏á‡∏ö‡∏≤‡∏•!",
    "‡πÉ‡∏Ñ‡∏£‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡πÅ‡∏ô‡πà ‡∏°‡∏≤‡∏•‡∏≠‡∏á!",
    "‡∏≠‡∏¢‡∏≤‡∏Å‡∏•‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ!",
    "‡πÑ‡∏°‡πà‡∏´‡∏•‡∏±‡∏ö ‡πÑ‡∏°‡πà‡∏á‡πà‡∏ß‡∏á ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡πà‡∏ß‡∏á‡∏à‡∏±‡∏á‡∏Ñ‡πâ‡∏≤‡∏ö!",
    "‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏ï‡πä‡∏∞‡∏£‡∏≠‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ!",
    "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏∏‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤!",
    "‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏• ‡πÅ‡∏ï‡πà‡∏Å‡πá‡∏ã‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô!"
  ];

  async function loadChallenges() {
    listDiv.innerHTML = "üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤...";

    try {
      const res = await fetch(endpoint + "?func=getChallengeList");
      const all = await res.json();

      const approved = all.filter(row =>
        row["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤"] === "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" || row["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤"] === "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏ß‡∏•"
      );

      if (approved.length === 0) {
        listDiv.innerHTML = "<p>üì≠ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢<br>‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!</p>";
        return;
      }

      listDiv.innerHTML = "";

      approved.forEach(row => {
        const type = row["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"] || "open";
        const codename = row["Codename"] || "-";
        const wager = row["‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô"] || "-";
        const targetName = row["‡∏ú‡∏π‡πâ‡∏ñ‡∏π‡∏Å‡∏ó‡πâ‡∏≤"] || "-";
        const title = row["‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤"] || "-";
        const mode = row["‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö"] || "-";
        const accepted = row["‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö"];
        const status = row["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤"];
        const detailId = `detail-${row["ID"]}`;

        const description = type === "direct"
          ? `üëë ${codename} ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡πâ‡∏≤ ${targetName}`
          : `üëë ${codename} ${openPhrases[Math.floor(Math.random() * openPhrases.length)]}`;

        const card = document.createElement("div");
        card.className = "challenge-card";
        if (status === "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏ß‡∏•") card.classList.add("ready");

        const typeSpan = document.createElement("span");
        typeSpan.className = `challenge-type ${type}`;
        typeSpan.textContent = type.toUpperCase();

        const mainDiv = document.createElement("div");
        mainDiv.className = "challenge-main";

        const descP = document.createElement("p");
        descP.textContent = `${description} ‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô: ${wager}`;

        const detailBtn = document.createElement("button");
        detailBtn.className = "button-secondary";
        detailBtn.textContent = "üîç ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î";
        detailBtn.addEventListener("click", () => {
          const el = document.getElementById(detailId);
          if (el) {
            el.style.display = (el.style.display === "none" || !el.style.display) ? "block" : "none";
          }
        });

        const detailDiv = document.createElement("div");
        detailDiv.id = detailId;
        detailDiv.className = "detail-section";
        detailDiv.innerHTML = `
          ${type === "direct" ? `üéØ ‡∏ú‡∏π‡πâ‡∏ñ‡∏π‡∏Å‡∏ó‡πâ‡∏≤: ${targetName}<br>` : ""}
          üìù ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤: ${title}<br>
          üéÆ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ${mode}<br>
          ${accepted ? `üìå ‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö: ${accepted}` : ""}
        `;

        mainDiv.appendChild(descP);
        mainDiv.appendChild(detailBtn);
        mainDiv.appendChild(detailDiv);

        const actionDiv = document.createElement("div");
        actionDiv.className = "challenge-actions";

        if (!accepted) {
          const acceptBtn = document.createElement("button");
          acceptBtn.className = "button-accept";
          acceptBtn.textContent = "‚úÖ ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤";
          acceptBtn.onclick = () => showAcceptForm(row["ID"], type, targetName);
          actionDiv.appendChild(acceptBtn);
        } else {
          const ready = document.createElement("p");
          ready.className = "duel-ready";
          ready.textContent = "üî• ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏ß‡∏•";
          actionDiv.appendChild(ready);
        }

        card.appendChild(typeSpan);
        card.appendChild(mainDiv);
        card.appendChild(actionDiv);

        listDiv.appendChild(card);
      });
    } catch (err) {
      console.error("‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err);
      listDiv.innerHTML = "<p>‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤‡πÑ‡∏î‡πâ</p>";
    }
  }

  window.addEventListener("DOMContentLoaded", () => {
    console.log("üì¶ DOM Loaded ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å loadChallenges()");
    loadChallenges();
  });
</script>
<script>
  // ‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤
  function showAcceptForm(id, type, target) {
    document.getElementById("accept-id").value = id;
    document.getElementById("accept-type").value = type;
    document.getElementById("accept-target").value = target;
    document.getElementById("accept-form").classList.remove("hidden");
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
  }

  // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤
  async function submitAccept() {
    const phone = document.getElementById("accept-phone").value.trim();
    const fullname = document.getElementById("accept-fullname").value.trim();
    const id = document.getElementById("accept-id").value;
    const type = document.getElementById("accept-type").value;
    const target = document.getElementById("accept-target").value;

    try {
      const res = await fetch(endpoint + "?func=acceptChallenge", {
        method: "POST",
        body: JSON.stringify({ phone, fullname, id, type, target })
      });
      const text = await res.text();
      alert(text.includes("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à") ? "‚úÖ ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏ß‡∏• !!" : text);
      location.reload();
    } catch {
      alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
    }
  }

  // ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤
  const trainerBtn = document.getElementById("show-trainer-form-btn");
  const partyBtn = document.getElementById("show-party-auth-btn");
  const trainerForm = document.getElementById("challenge-form");
  const partyAuthForm = document.getElementById("party-auth-form");
  const partyChallengeForm = document.getElementById("party-challenge-form");

  trainerBtn.onclick = () => {
    trainerForm.classList.remove("hidden");
    partyAuthForm.classList.add("hidden");
    partyChallengeForm.classList.add("hidden");
  };
  partyBtn.onclick = () => {
    trainerForm.classList.add("hidden");
    partyAuthForm.classList.remove("hidden");
    partyChallengeForm.classList.add("hidden");
  };

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ ‚Üí ‡∏î‡∏∂‡∏á codename ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
  document.getElementById("verify-btn").addEventListener("click", async () => {
    let phone = document.getElementById("phone").value.trim();
    if (phone.length === 9 && !phone.startsWith("0")) phone = "0" + phone;

    const res = await fetch(endpoint + "?func=getCodename&phone=" + phone);
    const codename = await res.text();
    document.getElementById("codename-display").innerText = `üîé Codename ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: ${codename}`;
    document.getElementById("form-fields").classList.remove("hidden");

    const resNames = await fetch(endpoint + "?func=getCodenameList");
    const names = await resNames.json();
    const targetSelect = document.getElementById("target");
    const filtered = names.filter(name => name.trim().toLowerCase() !== codename.trim().toLowerCase());
    targetSelect.innerHTML = filtered.length > 0
      ? filtered.map(name => `<option value="${name}">${name}</option>`).join("")
      : `<option disabled selected>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏∑‡πà‡∏ô</option>`;
  });

  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤
  document.getElementById("type").onchange = e => {
    const type = e.target.value;
    const showTarget = type === "direct";
    const showParty = type === "party";
    document.getElementById("target-select-container").classList.toggle("hidden", !showTarget);
    document.getElementById("party-select-container").classList.toggle("hidden", !showParty);
    if (showParty) loadPartyList();
  };

  let myCodename = "";
  let myPartyName = "";

  document.getElementById("verify-party-leader-btn").onclick = async () => {
    console.log("[DEBUG] ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏Å‡∏î");
    const phone = document.getElementById("party-leader-phone").value.trim();
    const fullname = document.getElementById("party-leader-fullname").value.trim();
    if (!phone || !fullname) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
    try {
      const res = await fetch(endpoint + "?func=verifyPartyLeader", {
        method: "POST",
        body: JSON.stringify({ phone, fullname })
      });
      const result = await res.text();
      console.log("[DEBUG] ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå verifyPartyLeader:", result);
      if (result === "ok") {
        // ‡∏î‡∏∂‡∏á codename ‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏µ‡πâ
        const profileRes = await fetch(endpoint + `?func=getMemberProfile&phone=${phone}`);
        const profile = await profileRes.json();
        myCodename = profile.codename;
        myPartyName = profile.partyName;
        document.getElementById("my-party-info").innerHTML = `üë§ Codename: <b>${myCodename}</b> | üõ°Ô∏è ‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ: <b>${myPartyName}</b>`;
        partyAuthForm.classList.add("hidden");
        partyChallengeForm.classList.remove("hidden");
        loadPartyList(phone, profile.partyName);
      } else {
        alert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ");
      }
    } catch (err) {
      alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err);
      console.error("[ERROR] verify-party-leader-btn:", err);
    }
  };

  async function loadPartyList(myPhone = null, myParty = null) {
    try {
      const res = await fetch(endpoint + "?func=getPartyList");
      const parties = await res.json();
      console.log("[DEBUG] party list (raw):", parties);
      console.log("[DEBUG] myParty:", myParty);
      let filtered = parties;
      if (myParty) {
        filtered = parties.filter(party => party.name.trim() !== myParty.trim());
      }
      console.log("[DEBUG] party list (filtered):", filtered);
      const partySelect = document.getElementById("party-target");
      if (filtered.length > 0) {
        partySelect.innerHTML = filtered.map(party => `<option value=\"${party.name}\">${party.name} (${party.memberCount} ‡∏Ñ‡∏ô)</option>`).join("");
      } else {
        partySelect.innerHTML = `<option disabled selected>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ‡∏≠‡∏∑‡πà‡∏ô</option>`;
      }
      console.log("[DEBUG] party-target innerHTML:", partySelect.innerHTML);
    } catch (err) {
      const partySelect = document.getElementById("party-target");
      partySelect.innerHTML = `<option disabled selected>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ</option>`;
      console.error("‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err);
    }
  }

  // ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ó‡πâ‡∏≤
  document.getElementById("challenge-form").onsubmit = async (e) => {
    e.preventDefault();
    let phone = document.getElementById("phone").value.trim();
    if (phone.length === 9 && !phone.startsWith("0")) phone = "0" + phone;
    const type = document.getElementById("type").value;
    const target = type === "direct" ? document.getElementById("target").value : "";
    const partyTarget = type === "party" ? document.getElementById("party-target").value : "";
    const mode = document.getElementById("mode").value;
    const wager = document.getElementById("wager").value;
    const title = document.getElementById("title").value;
    try {
      let body;
      let func;
      if (type === "party") {
        func = "submitPartyChallenge";
        body = JSON.stringify({ phone, type, targetParty: partyTarget, mode, wager, title });
      } else {
        func = "submitChallengeRequest";
        body = JSON.stringify({ phone, type, target, mode, wager, title });
      }
      const res = await fetch(endpoint + `?func=${func}` , {
        method: "POST",
        body
      });
      const text = await res.text();
      alert(text);
      e.target.reset();
      location.reload();
    } catch {
      alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
    }
  };

  // ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° Party vs Party
  partyChallengeForm.onsubmit = async (e) => {
    e.preventDefault();
    const phone = document.getElementById("party-leader-phone").value.trim();
    const size = document.getElementById("party-size").value;
    const type = document.getElementById("party-type").value;
    const mode = document.getElementById("party-mode").value;
    const targetParty = document.getElementById("party-target").value;
    const wager = document.getElementById("party-wager").value;
    const title = document.getElementById("party-title").value;
    try {
      const res = await fetch(endpoint + "?func=submitPartyChallenge", {
        method: "POST",
        body: JSON.stringify({ phone, size, type, mode, targetParty, wager, title })
      });
      const text = await res.text();
      alert(text);
      e.target.reset();
      location.reload();
    } catch {
      alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
    }
  };
</script>
</body>
</html>
