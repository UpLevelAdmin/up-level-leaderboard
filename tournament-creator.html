<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tournament Pairing Creator - Up Level Guild</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    * {
      font-family: 'Kanit', sans-serif;
      box-sizing: border-box;
    }
    
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      color: #333;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      overflow: hidden;
    }
    
    /* Header */
    .header {
      background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%);
      padding: 30px;
      text-align: center;
      color: white;
      position: relative;
    }
    
    .home-button {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 50px;
      height: 50px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .home-button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }
    
    .header h1 {
      margin: 0;
      font-size: 2.5rem;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .header p {
      margin: 10px 0 0 0;
      font-size: 1.1rem;
      opacity: 0.9;
    }
    
    /* Main Content */
    .main-content {
      padding: 30px;
    }
    
    /* Tournament Creation Form */
    .tournament-form {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      border: 2px solid #e9ecef;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #495057;
    }
    
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }
    
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    /* Player Management */
    .player-management {
      background: #fff;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      border: 2px solid #e9ecef;
    }
    
    .player-input {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .player-input input {
      flex: 1;
      padding: 12px 15px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-size: 16px;
    }
    
    .quick-add-section {
      background: #e3f2fd;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .quick-add-section h4 {
      margin: 0 0 15px 0;
      color: #1976d2;
    }
    
    .quick-add-section .btn {
      margin: 5px;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
    }
    
    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
      color: white;
    }
    
    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(220, 53, 69, 0.3);
    }
    
    .btn-warning {
      background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
      color: white;
    }
    
    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 193, 7, 0.3);
    }
    
    .btn-info {
      background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
      color: white;
    }
    
    .btn-info:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(23, 162, 184, 0.3);
    }
    
    /* Player List */
    .player-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .player-card {
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .player-card:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }
    
    .player-card .player-name {
      font-weight: 600;
      font-size: 16px;
      margin-bottom: 5px;
      color: #495057;
    }
    
    .player-card .player-id {
      font-size: 14px;
      color: #6c757d;
      margin-bottom: 5px;
    }
    
    .player-card .player-phone {
      font-size: 12px;
      color: #28a745;
      margin-bottom: 5px;
    }
    
    .player-card .player-status {
      font-size: 10px;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    
    .player-card .player-status.dropped {
      background: #dc3545;
      color: white;
    }
    
    .player-card .remove-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 25px;
      height: 25px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Tournament Display */
    .tournament-display {
      background: #fff;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      border: 2px solid #e9ecef;
      display: none;
    }
    
    .tournament-display.active {
      display: block;
    }
    
    .tournament-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #e9ecef;
    }
    
    .tournament-header h2 {
      margin: 0 0 10px 0;
      color: #495057;
      font-size: 2rem;
    }
    
    .tournament-header .tournament-type {
      background: #667eea;
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 14px;
      display: inline-block;
    }
    
    /* Matches Display */
    .matches-section {
      margin-bottom: 30px;
    }
    
    .matches-section h3 {
      color: #495057;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }
    
    .round-matches {
      margin-bottom: 25px;
    }
    
    .round-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px;
      border-radius: 10px 10px 0 0;
      font-weight: 600;
      font-size: 18px;
      text-align: center;
    }
    
    .match-card {
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-top: none;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
    }
    
    .match-card:last-child {
      border-radius: 0 0 10px 10px;
    }
    
    .match-card:hover {
      background: #e9ecef;
    }
    
    .match-players {
      display: flex;
      align-items: center;
      gap: 20px;
      flex: 1;
    }
    
    .player-info {
      text-align: center;
      flex: 1;
    }
    
    .player-info .name {
      font-weight: 600;
      font-size: 16px;
      color: #495057;
    }
    
    .player-info .id {
      font-size: 12px;
      color: #6c757d;
    }
    
    .vs {
      font-weight: 700;
      color: #667eea;
      font-size: 18px;
    }
    
    .match-result {
      display: flex;
      gap: 10px;
    }
    
    .result-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .result-btn.win {
      background: #28a745;
      color: white;
    }
    
    .result-btn.draw {
      background: #ffc107;
      color: #212529;
    }
    
    .result-btn.double-loss {
      background: #6c757d;
      color: white;
    }
    
    .result-btn:hover {
      transform: scale(1.05);
    }
    
    .result-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Standings */
    .standings-section {
      margin-bottom: 30px;
    }
    
    .standings-section h3 {
      color: #495057;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }
    
    .standings-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .standings-table th {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px;
      font-weight: 600;
      text-align: center;
    }
    
    .standings-table td {
      padding: 12px 15px;
      text-align: center;
      border-bottom: 1px solid #e9ecef;
    }
    
    .standings-table tr:hover {
      background: #f8f9fa;
    }
    
    .standings-table .rank {
      font-weight: 700;
      color: #667eea;
    }
    
    .standings-table .points {
      font-weight: 700;
      color: #28a745;
    }
    
    /* Actions */
    .actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
      color: #6c757d;
    }
    
    .spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .container {
        margin: 10px;
        border-radius: 15px;
      }
      
      .main-content {
        padding: 20px;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .player-input {
        flex-direction: column;
      }
      
      .match-card {
        flex-direction: column;
        gap: 15px;
      }
      
      .match-players {
        flex-direction: column;
        gap: 10px;
      }
      
      .actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <button class="home-button" onclick="goHome()" title="‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å">üè†</button>
      <h1>üèÜ Tournament Pairing Creator</h1>
      <p>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÅ‡∏ö‡∏ö Round Robin ‡πÅ‡∏•‡∏∞ Bracket ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢‡∏î‡∏≤‡∏¢</p>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
      <!-- Tournament Creation Form -->
      <div class="tournament-form">
        <h2 style="margin-top: 0; color: #495057;">üìù ‡∏™‡∏£‡πâ‡∏≤‡∏á Tournament ‡πÉ‡∏´‡∏°‡πà</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="tournamentName">‡∏ä‡∏∑‡πà‡∏≠ Tournament</label>
            <input type="text" id="tournamentName" placeholder="‡πÄ‡∏ä‡πà‡∏ô Up Level Guild Tournament">
          </div>
          
          <div class="form-group">
            <label for="tournamentType">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</label>
            <select id="tournamentType">
              <option value="round_robin">Round Robin (‡∏û‡∏ö‡∏Å‡∏±‡∏ô‡∏´‡∏°‡∏î)</option>
              <option value="swiss">Swiss Round (‡∏™‡∏ß‡∏¥‡∏™)</option>
              <option value="single_elimination">Single Elimination (‡πÅ‡∏û‡πâ‡∏Ñ‡∏±‡∏î‡∏≠‡∏≠‡∏Å)</option>
              <option value="double_elimination">Double Elimination (‡πÅ‡∏û‡πâ‡∏Ñ‡∏±‡∏î‡∏≠‡∏≠‡∏Å 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label for="tournamentDescription">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
          <input type="text" id="tournamentDescription" placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô">
        </div>
        
        <button class="btn btn-primary" onclick="createTournament()" style="width: 100%;">
          üöÄ ‡∏™‡∏£‡πâ‡∏≤‡∏á Tournament
        </button>
      </div>
      
      <!-- Player Management -->
      <div class="player-management" id="playerManagement" style="display: none;">
        <h2 style="margin-top: 0; color: #495057;">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h2>
        
        <div class="player-input">
          <input type="text" id="playerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô">
          <input type="text" id="playerId" placeholder="ID ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô">
          <input type="text" id="playerPhone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">
          <button class="btn btn-success" onclick="addPlayer()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>
        </div>
        
        <!-- Quick Add Players -->
        <div class="quick-add-section">
          <h4>üöÄ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏ö‡∏ö‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß</h4>
          <button class="btn btn-primary" onclick="showQuickAddDialog()">üìã ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
          <button class="btn btn-warning" onclick="addSamplePlayers()">üéÆ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</button>
        </div>
        
        <div class="player-list" id="playerList"></div>
        
        <div style="text-align: center;">
          <button class="btn btn-warning" onclick="startTournament()" id="startBtn" disabled>
            üèÅ ‡πÄ‡∏£‡∏¥‡πà‡∏° Tournament
          </button>
        </div>
      </div>
      
      <!-- Tournament Display -->
      <div class="tournament-display" id="tournamentDisplay">
        <div class="tournament-header">
          <h2 id="tournamentTitle"></h2>
          <span class="tournament-type" id="tournamentTypeDisplay"></span>
        </div>
        
        <!-- Matches Section -->
        <div class="matches-section" id="matchesSection">
          <h3>‚öîÔ∏è ‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</h3>
          <div id="matchesList"></div>
        </div>
        
        <!-- Standings Section -->
        <div class="standings-section" id="standingsSection">
          <h3>üìä ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</h3>
          <div id="standingsTable"></div>
        </div>
        
        <!-- Swiss Round Controls -->
        <div class="swiss-controls" id="swissControls" style="display: none;">
          <h3>üéØ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Swiss Round</h3>
          <div class="actions">
            <button class="btn btn-primary" onclick="generateNextRound()" id="nextRoundBtn">‚û°Ô∏è ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
            <button class="btn btn-warning" onclick="showRoundInfo()">üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö</button>
            <button class="btn btn-danger" onclick="showDropPlayerDialog()">üö´ Drop ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>
            <button class="btn btn-success" onclick="showUndropPlayerDialog()">‚úÖ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å Drop</button>
          </div>
        </div>
        
        <!-- Actions -->
        <div class="actions">
          <button class="btn btn-primary" onclick="exportTournament()">üì§ Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
          <button class="btn btn-success" onclick="openDisplayPage()">üåê ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</button>
          <button class="btn btn-info" onclick="toggleStandingsVisibility()" id="toggleStandingsBtn">üëÅÔ∏è ‡∏ã‡πà‡∏≠‡∏ô Standing</button>
          <button class="btn btn-info" onclick="saveToGoogleSheets()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets</button>
          <button class="btn btn-warning" onclick="resetTournament()">üîÑ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà</button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Tournament Manager Class
    class TournamentManager {
      constructor() {
        this.tournaments = JSON.parse(localStorage.getItem('tournaments') || '[]');
        this.currentTournament = JSON.parse(localStorage.getItem('currentTournament') || 'null');
        this.currentPlayers = JSON.parse(localStorage.getItem('currentPlayers') || '[]');
      }
      
      // Create new tournament
      createTournament(name, type, description) {
        const tournament = {
          id: Date.now(),
          name: name,
          type: type,
          description: description || '',
          players: [],
          matches: [],
          standings: [],
          status: 'created',
          createdAt: new Date().toISOString()
        };
        
        this.currentTournament = tournament;
        this.saveCurrentTournament();
        return tournament;
      }
      
      // Add player to current tournament
      addPlayer(name, id, phone) {
        if (!this.currentTournament) return false;
        
        const player = {
          id: id || `P${Date.now()}`,
          name: name,
          phone: phone || '',
          wins: 0,
          draws: 0,
          losses: 0,
          doubleLosses: 0,
          points: 0,
          owPercent: 0,
          h2hScore: 0,
          isDropped: false
        };
        
        this.currentTournament.players.push(player);
        this.currentPlayers.push(player);
        this.saveCurrentTournament();
        this.saveCurrentPlayers();
        this.sendRealTimeUpdate();
        return true;
      }
      
      // Remove player from current tournament
      removePlayer(playerId) {
        if (!this.currentTournament) return false;
        
        this.currentTournament.players = this.currentTournament.players.filter(p => p.id !== playerId);
        this.currentPlayers = this.currentPlayers.filter(p => p.id !== playerId);
        this.saveCurrentTournament();
        this.saveCurrentPlayers();
        this.sendRealTimeUpdate();
        return true;
      }
      
      // Generate matches based on tournament type
      generateMatches() {
        if (!this.currentTournament) return;
        
        switch (this.currentTournament.type) {
          case 'round_robin':
            this.generateRoundRobinMatches();
            break;
          case 'swiss':
            this.generateSwissMatches();
            break;
          case 'single_elimination':
            this.generateSingleEliminationMatches();
            break;
          case 'double_elimination':
            this.generateDoubleEliminationMatches();
            break;
        }
      }
      
      // Generate Swiss Round matches (‡∏ó‡∏µ‡∏•‡∏∞‡∏£‡∏≠‡∏ö)
      generateSwissMatches() {
        const players = [...this.currentTournament.players];
        
        // Swiss Round: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        this.currentTournament.matches = [];
        this.currentTournament.currentRound = 1;
        this.currentTournament.maxRounds = Math.max(3, Math.ceil(Math.log2(players.length)));
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å
        this.generateNextSwissRound();
      }
      
      // Generate next Swiss round
      generateNextSwissRound() {
        if (!this.currentTournament) return;
        
        const currentRound = this.currentTournament.currentRound;
        const players = [...this.currentTournament.players];
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà
        this.updateStandings();
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ
        const roundMatches = this.generateSwissPairing(players, currentRound);
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà
        this.currentTournament.matches.push(...roundMatches);
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≠‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        this.currentTournament.currentRound = currentRound + 1;
        this.saveCurrentTournament();
        this.sendRealTimeUpdate();
      }
      
      // Generate Swiss Pairing for a specific round (‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å Swiss Tournament)
      generateSwissPairing(players, round) {
        const matches = [];
        const availablePlayers = players.filter(p => !p.isDropped);
        
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
        availablePlayers.sort((a, b) => {
          if (b.points !== a.points) return b.points - a.points;
          // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° Buchholz Score
          return (b.buchholzScore || 0) - (a.buchholzScore || 0);
        });
        
        // ‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏µ‡πà ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏î‡πâ BYE
        if (availablePlayers.length % 2 === 1) {
          const byePlayer = availablePlayers.pop();
          matches.push({
            id: `R${round}M${matches.length + 1}`,
            round: round,
            player1: byePlayer,
            player2: { id: 'BYE', name: 'BYE', isBye: true },
            result: 'player1', // BYE = ‡∏ä‡∏ô‡∏∞‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            status: 'completed'
          });
        }
        
        // ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å Swiss Tournament
        while (availablePlayers.length >= 2) {
          const player1 = availablePlayers.shift();
          let player2 = null;
          
          // ‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
          for (let i = 0; i < availablePlayers.length; i++) {
            const candidate = availablePlayers[i];
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡πÅ‡∏Ç‡πà‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!this.havePlayedBefore(player1, candidate)) {
              player2 = availablePlayers.splice(i, 1)[0];
              break;
            }
          }
          
          // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å
          if (!player2 && availablePlayers.length > 0) {
            player2 = availablePlayers.shift();
          }
          
          if (player2) {
            matches.push({
              id: `R${round}M${matches.length + 1}`,
              round: round,
              player1: player1,
              player2: player2,
              result: null,
              status: 'pending'
            });
          }
        }
        
        return matches;
      }
      
      // Check if two players have played before
      havePlayedBefore(player1, player2) {
        if (!this.currentTournament || !this.currentTournament.matches) return false;
        
        return this.currentTournament.matches.some(match => 
          (match.player1.id === player1.id && match.player2.id === player2.id) ||
          (match.player1.id === player2.id && match.player2.id === player1.id)
        );
      }
      
      // Generate Round Robin matches
      generateRoundRobinMatches() {
        const players = [...this.currentTournament.players];
        const n = players.length;
        const matches = [];
        
        // If odd number of players, add BYE
        if (n % 2 === 1) {
          players.push({ id: 'BYE', name: 'BYE', isBye: true });
        }
        
        const rounds = players.length - 1;
        const halfSize = players.length / 2;
        
        for (let round = 0; round < rounds; round++) {
          const roundMatches = [];
          
          for (let i = 0; i < halfSize; i++) {
            const player1 = players[i];
            const player2 = players[players.length - 1 - i];
            
            // Skip if one of them is BYE
            if (player1.isBye || player2.isBye) {
              continue;
            }
            
            roundMatches.push({
              id: `R${round + 1}M${i + 1}`,
              round: round + 1,
              player1: player1,
              player2: player2,
              result: null,
              status: 'pending'
            });
          }
          
          matches.push(...roundMatches);
          
          // Rotate players (Berger Table)
          const lastPlayer = players.pop();
          players.splice(1, 0, lastPlayer);
        }
        
        this.currentTournament.matches = matches;
        this.saveCurrentTournament();
      }
      
      // Generate Single Elimination matches
      generateSingleEliminationMatches() {
        const players = [...this.currentTournament.players];
        const matches = [];
        let round = 1;
        let currentPlayers = players;
        
        while (currentPlayers.length > 1) {
          const roundMatches = [];
          
          for (let i = 0; i < currentPlayers.length; i += 2) {
            const player1 = currentPlayers[i];
            const player2 = currentPlayers[i + 1] || { id: 'BYE', name: 'BYE', isBye: true };
            
            roundMatches.push({
              id: `R${round}M${Math.floor(i/2) + 1}`,
              round: round,
              player1: player1,
              player2: player2,
              result: null,
              status: 'pending'
            });
          }
          
          matches.push(...roundMatches);
          currentPlayers = currentPlayers.filter((_, i) => i % 2 === 0); // Winners advance
          round++;
        }
        
        this.currentTournament.matches = matches;
        this.saveCurrentTournament();
      }
      
      // Generate Double Elimination matches (simplified)
      generateDoubleEliminationMatches() {
        // For now, use single elimination logic
        // Double elimination is more complex and would need additional implementation
        this.generateSingleEliminationMatches();
      }
      
      // Record match result
      recordMatchResult(matchId, result) {
        if (!this.currentTournament) return;
        
        const match = this.currentTournament.matches.find(m => m.id === matchId);
        if (match) {
          match.result = result;
          match.status = 'completed';
          this.updateStandings();
          this.saveCurrentTournament();
          this.sendRealTimeUpdate();
        }
      }
      
      // Update standings
      updateStandings() {
        if (!this.currentTournament) return;
        
        // Reset all player stats
        this.currentTournament.players.forEach(player => {
          player.wins = 0;
          player.draws = 0;
          player.losses = 0;
          player.doubleLosses = 0;
          player.points = 0;
          player.owPercent = 0;
          player.h2hScore = 0;
          player.buchholzScore = 0;
        });
        
        // Calculate stats from completed matches
        this.currentTournament.matches.forEach(match => {
          if (match.result && match.status === 'completed') {
            const p1 = this.currentTournament.players.find(p => p.id === match.player1.id);
            const p2 = this.currentTournament.players.find(p => p.id === match.player2.id);
            
            if (p1 && p2) {
              switch (match.result) {
                case 'player1':
                  p1.wins++;
                  p1.points += 3;
                  p2.losses++;
                  break;
                case 'player2':
                  p2.wins++;
                  p2.points += 3;
                  p1.losses++;
                  break;
                case 'draw':
                  p1.draws++;
                  p1.points += 1;
                  p2.draws++;
                  p2.points += 1;
                  break;
                case 'double_loss':
                  p1.doubleLosses++;
                  p1.points += 0;
                  p2.doubleLosses++;
                  p2.points += 0;
                  break;
              }
            }
          }
        });
        
        // Calculate additional stats
        this.calculateOWPercent();
        this.calculateH2HScore();
        
        // Calculate Buchholz Score for Swiss Round
        if (this.currentTournament.type === 'swiss') {
          this.calculateBuchholzScore();
        }
        
        // Sort by points, then OW%, then H2H
        this.currentTournament.standings = [...this.currentTournament.players]
          .filter(p => !p.isDropped)
          .sort((a, b) => {
            // 1. ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            if (b.points !== a.points) return b.points - a.points;
            
            // 2. OW% (Opponent Win Percentage)
            if (b.owPercent !== a.owPercent) return b.owPercent - a.owPercent;
            
            // 3. H2H (Head to Head)
            if (b.h2hScore !== a.h2hScore) return b.h2hScore - a.h2hScore;
            
            // 4. Buchholz Score (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Swiss Round)
            if (this.currentTournament.type === 'swiss') {
              return (b.buchholzScore || 0) - (a.buchholzScore || 0);
            }
            
            return 0;
          });
      }
      
      // Calculate OW% (Opponent Win Percentage)
      calculateOWPercent() {
        this.currentTournament.players.forEach(player => {
          let totalOpponentWins = 0;
          let totalOpponentGames = 0;
          let opponentsCount = 0;
          
          // ‡∏´‡∏≤‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ
          this.currentTournament.matches.forEach(match => {
            if (match.status === 'completed' && !match.player2.isBye) {
              let opponent = null;
              if (match.player1.id === player.id) {
                opponent = this.currentTournament.players.find(p => p.id === match.player2.id);
              } else if (match.player2.id === player.id) {
                opponent = this.currentTournament.players.find(p => p.id === match.player1.id);
              }
              
              if (opponent && !opponent.isDropped) {
                totalOpponentWins += opponent.wins;
                totalOpponentGames += opponent.wins + opponent.draws + opponent.losses + opponent.doubleLosses;
                opponentsCount++;
              }
            }
          });
          
          // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì OW%
          player.owPercent = totalOpponentGames > 0 ? (totalOpponentWins / totalOpponentGames) * 100 : 0;
        });
      }
      
      // Calculate H2H Score
      calculateH2HScore() {
        this.currentTournament.players.forEach(player => {
          let h2hScore = 0;
          
          // ‡∏´‡∏≤‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô
          const samePointsPlayers = this.currentTournament.players.filter(p => 
            p.id !== player.id && p.points === player.points && !p.isDropped
          );
          
          samePointsPlayers.forEach(opponent => {
            // ‡∏´‡∏≤‡πÅ‡∏°‡∏ï‡∏ä‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏Å‡∏±‡∏ô
            const match = this.currentTournament.matches.find(m => 
              m.status === 'completed' && 
              ((m.player1.id === player.id && m.player2.id === opponent.id) ||
               (m.player2.id === player.id && m.player1.id === opponent.id))
            );
            
            if (match) {
              if (match.result === 'player1') {
                h2hScore += (match.player1.id === player.id) ? 1 : -1;
              } else if (match.result === 'player2') {
                h2hScore += (match.player2.id === player.id) ? 1 : -1;
              }
            }
          });
          
          player.h2hScore = h2hScore;
        });
      }
      
      // Calculate Buchholz Score for Swiss Round
      calculateBuchholzScore() {
        this.currentTournament.players.forEach(player => {
          let buchholzScore = 0;
          let opponentsCount = 0;
          
          // ‡∏´‡∏≤‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ
          this.currentTournament.matches.forEach(match => {
            if (match.status === 'completed' && !match.player2.isBye) {
              let opponent = null;
              if (match.player1.id === player.id) {
                opponent = this.currentTournament.players.find(p => p.id === match.player2.id);
              } else if (match.player2.id === player.id) {
                opponent = this.currentTournament.players.find(p => p.id === match.player1.id);
              }
              
              if (opponent && !opponent.isDropped) {
                buchholzScore += opponent.points;
                opponentsCount++;
              }
            }
          });
          
          // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Buchholz Score ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢
          player.buchholzScore = opponentsCount > 0 ? buchholzScore / opponentsCount : 0;
        });
      }
      
      // Drop player
      dropPlayer(playerId) {
        if (!this.currentTournament) return false;
        
        const player = this.currentTournament.players.find(p => p.id === playerId);
        if (player) {
          player.isDropped = true;
          this.saveCurrentTournament();
          this.sendRealTimeUpdate();
          return true;
        }
        return false;
      }
      
      // Undrop player
      undropPlayer(playerId) {
        if (!this.currentTournament) return false;
        
        const player = this.currentTournament.players.find(p => p.id === playerId);
        if (player) {
          player.isDropped = false;
          this.saveCurrentTournament();
          this.sendRealTimeUpdate();
          return true;
        }
        return false;
      }
      
      // Save current tournament to localStorage
      saveCurrentTournament() {
        if (this.currentTournament) {
          localStorage.setItem('currentTournament', JSON.stringify(this.currentTournament));
        }
      }
      
      // Save current players to localStorage
      saveCurrentPlayers() {
        localStorage.setItem('currentPlayers', JSON.stringify(this.currentPlayers));
      }
      
      // Save tournament to tournaments list
      saveTournament() {
        if (this.currentTournament) {
          this.tournaments.push(this.currentTournament);
          localStorage.setItem('tournaments', JSON.stringify(this.tournaments));
        }
      }
      
      // Send real-time update to display page
      sendRealTimeUpdate() {
        if (!this.currentTournament) {
          console.log('No current tournament to send');
          return;
        }
        
        const tournamentData = {
          name: this.currentTournament.name,
          type: this.currentTournament.type,
          players: this.currentTournament.players,
          matches: this.currentTournament.matches,
          standings: this.currentTournament.standings,
          currentRound: this.currentTournament.currentRound,
          maxRounds: this.currentTournament.maxRounds,
          standingsVisible: standingsVisible,
          timestamp: new Date().toISOString()
        };
        
        console.log('Sending tournament data:', tournamentData);
        
        // Save to localStorage for display page
        localStorage.setItem('lastTournamentData', JSON.stringify(tournamentData));
        console.log('Saved to localStorage: lastTournamentData');
        
        // Send message to display page if it's open
        if (window.displayWindow && !window.displayWindow.closed) {
          console.log('Sending postMessage to display window');
          window.displayWindow.postMessage({
            type: 'tournamentData',
            data: tournamentData
          }, '*');
        } else {
          console.log('Display window not open or closed');
        }
      }
      
      // Export tournament data
      exportTournament() {
        if (!this.currentTournament) return;
        
        const data = {
          tournament: this.currentTournament,
          exportDate: new Date().toISOString()
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${this.currentTournament.name}_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
      }
    }
    
    // Initialize tournament manager
    const tournamentManager = new TournamentManager();
    
    // Global variable to track standings visibility
    let standingsVisible = true;
    
    // Load existing tournament data on page load
    document.addEventListener('DOMContentLoaded', function() {
      if (tournamentManager.currentTournament) {
        // Restore tournament form
        document.getElementById('tournamentName').value = tournamentManager.currentTournament.name;
        document.getElementById('tournamentType').value = tournamentManager.currentTournament.type;
        document.getElementById('tournamentDescription').value = tournamentManager.currentTournament.description || '';
        
        // Disable form fields
        document.getElementById('tournamentName').disabled = true;
        document.getElementById('tournamentType').disabled = true;
        document.getElementById('tournamentDescription').disabled = true;
        
        // Show player management
        document.getElementById('playerManagement').style.display = 'block';
        
        // Update player list
        updatePlayerList();
        
        // Enable start button if we have at least 2 players
        if (tournamentManager.currentPlayers.length >= 2) {
          document.getElementById('startBtn').disabled = false;
        }
        
        // If tournament is already started, show tournament display
        if (tournamentManager.currentTournament.matches && tournamentManager.currentTournament.matches.length > 0) {
          document.getElementById('tournamentDisplay').classList.add('active');
          
          // Update tournament info
          document.getElementById('tournamentTitle').textContent = tournamentManager.currentTournament.name;
          document.getElementById('tournamentTypeDisplay').textContent = 
            tournamentManager.currentTournament.type === 'round_robin' ? 'Round Robin' :
            tournamentManager.currentTournament.type === 'swiss' ? 'Swiss Round' :
            tournamentManager.currentTournament.type === 'single_elimination' ? 'Single Elimination' :
            'Double Elimination';
          
          // Show Swiss controls if it's Swiss Round
          if (tournamentManager.currentTournament.type === 'swiss') {
            document.getElementById('swissControls').style.display = 'block';
            updateSwissControls();
          }
          
          // Update matches and standings
          updateMatchesDisplay();
          updateStandingsDisplay();
        }
      }
    });
    
    // UI Functions
    function createTournament() {
      const name = document.getElementById('tournamentName').value.trim();
      const type = document.getElementById('tournamentType').value;
      const description = document.getElementById('tournamentDescription').value.trim();
      
      if (!name) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ Tournament');
        return;
      }
      
      if (tournamentManager.currentTournament) {
        if (!confirm('‡∏°‡∏µ Tournament ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
          return;
        }
      }
      
      tournamentManager.createTournament(name, type, description);
      
      // Show player management
      document.getElementById('playerManagement').style.display = 'block';
      document.getElementById('tournamentName').disabled = true;
      document.getElementById('tournamentType').disabled = true;
      document.getElementById('tournamentDescription').disabled = true;
      
      // Clear player list
      tournamentManager.currentPlayers = [];
      updatePlayerList();
    }
    
    function addPlayer() {
      const name = document.getElementById('playerName').value.trim();
      const id = document.getElementById('playerId').value.trim();
      const phone = document.getElementById('playerPhone').value.trim();
      
      if (!name) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô');
        return;
      }
      
      if (tournamentManager.addPlayer(name, id, phone)) {
        updatePlayerList();
        document.getElementById('playerName').value = '';
        document.getElementById('playerId').value = '';
        document.getElementById('playerPhone').value = '';
        
        // Enable start button if we have at least 2 players
        if (tournamentManager.currentPlayers.length >= 2) {
          document.getElementById('startBtn').disabled = false;
        }
      }
    }
    
    function removePlayer(playerId) {
      if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        tournamentManager.removePlayer(playerId);
        updatePlayerList();
        
        // Disable start button if we have less than 2 players
        if (tournamentManager.currentPlayers.length < 2) {
          document.getElementById('startBtn').disabled = true;
        }
      }
    }
    
    function updatePlayerList() {
      const playerList = document.getElementById('playerList');
      playerList.innerHTML = '';
      
      tournamentManager.currentPlayers.forEach(player => {
        const playerCard = document.createElement('div');
        playerCard.className = 'player-card';
        playerCard.innerHTML = `
          <button class="remove-btn" onclick="removePlayer('${player.id}')" title="‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô">√ó</button>
          <div class="player-name">${player.name}</div>
          <div class="player-id">ID: ${player.id}</div>
          ${player.phone ? `<div class="player-phone">üìû ${player.phone}</div>` : ''}
          ${player.isDropped ? `<div class="player-status dropped">üö´ DROPPED</div>` : ''}
        `;
        playerList.appendChild(playerCard);
      });
    }
    
    function startTournament() {
      if (tournamentManager.currentPlayers.length < 2) {
        alert('‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏Ñ‡∏ô');
        return;
      }
      
      // Generate matches
      tournamentManager.generateMatches();
      
      // Show tournament display
      document.getElementById('tournamentDisplay').classList.add('active');
      
      // Update tournament info
      document.getElementById('tournamentTitle').textContent = tournamentManager.currentTournament.name;
      document.getElementById('tournamentTypeDisplay').textContent = 
        tournamentManager.currentTournament.type === 'round_robin' ? 'Round Robin' :
        tournamentManager.currentTournament.type === 'swiss' ? 'Swiss Round' :
        tournamentManager.currentTournament.type === 'single_elimination' ? 'Single Elimination' :
        'Double Elimination';
      
      // Show Swiss controls if it's Swiss Round
      if (tournamentManager.currentTournament.type === 'swiss') {
        document.getElementById('swissControls').style.display = 'block';
        updateSwissControls();
      }
      
      // Update matches and standings
      updateMatchesDisplay();
      updateStandingsDisplay();
      
      // Save tournament
      tournamentManager.saveTournament();
    }
    
    function updateMatchesDisplay() {
      const matchesList = document.getElementById('matchesList');
      matchesList.innerHTML = '';
      
      if (!tournamentManager.currentTournament || !tournamentManager.currentTournament.matches.length) {
        matchesList.innerHTML = '<p style="text-align: center; color: #6c757d;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</p>';
        return;
      }
      
      // Group matches by round
      const matchesByRound = {};
      tournamentManager.currentTournament.matches.forEach(match => {
        if (!matchesByRound[match.round]) {
          matchesByRound[match.round] = [];
        }
        matchesByRound[match.round].push(match);
      });
      
      // Display matches by round
      Object.keys(matchesByRound).sort((a, b) => parseInt(a) - parseInt(b)).forEach(round => {
        const roundDiv = document.createElement('div');
        roundDiv.className = 'round-matches';
        
        const roundHeader = document.createElement('div');
        roundHeader.className = 'round-header';
        roundHeader.textContent = `‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${round}`;
        roundDiv.appendChild(roundHeader);
        
        matchesByRound[round].forEach(match => {
          const matchCard = document.createElement('div');
          matchCard.className = 'match-card';
          
          const matchPlayers = document.createElement('div');
          matchPlayers.className = 'match-players';
          
          const player1Info = document.createElement('div');
          player1Info.className = 'player-info';
          player1Info.innerHTML = `
            <div class="name">${match.player1.name}</div>
            <div class="id">${match.player1.id}</div>
          `;
          
          const vs = document.createElement('div');
          vs.className = 'vs';
          vs.textContent = 'VS';
          
          const player2Info = document.createElement('div');
          player2Info.className = 'player-info';
          player2Info.innerHTML = `
            <div class="name">${match.player2.name}</div>
            <div class="id">${match.player2.id}</div>
          `;
          
          matchPlayers.appendChild(player1Info);
          matchPlayers.appendChild(vs);
          matchPlayers.appendChild(player2Info);
          
          const matchResult = document.createElement('div');
          matchResult.className = 'match-result';
          
          if (match.status === 'completed') {
            matchResult.innerHTML = `
              <span style="color: #28a745; font-weight: 600;">
                ${getResultText(match.result)}
              </span>
            `;
          } else {
            if (match.player2.isBye) {
              matchResult.innerHTML = `
                <span style="color: #28a745; font-weight: 600;">
                  ${match.player1.name} ‡πÑ‡∏î‡πâ BYE (‡∏ä‡∏ô‡∏∞‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
                </span>
              `;
            } else {
              matchResult.innerHTML = `
                <button class="result-btn win" onclick="recordResult('${match.id}', 'player1')">
                  ${match.player1.name} ‡∏ä‡∏ô‡∏∞
                </button>
                <button class="result-btn draw" onclick="recordResult('${match.id}', 'draw')">
                  ‡πÄ‡∏™‡∏°‡∏≠
                </button>
                <button class="result-btn win" onclick="recordResult('${match.id}', 'player2')">
                  ${match.player2.name} ‡∏ä‡∏ô‡∏∞
                </button>
                <button class="result-btn double-loss" onclick="recordResult('${match.id}', 'double_loss')">
                  ‡πÅ‡∏û‡πâ‡∏Ñ‡∏π‡πà
                </button>
              `;
            }
          }
          
          matchCard.appendChild(matchPlayers);
          matchCard.appendChild(matchResult);
          roundDiv.appendChild(matchCard);
        });
        
        matchesList.appendChild(roundDiv);
      });
    }
    
    function updateStandingsDisplay() {
      const standingsTable = document.getElementById('standingsTable');
      standingsTable.innerHTML = '';
      
      if (!tournamentManager.currentTournament || !tournamentManager.currentTournament.standings.length) {
        standingsTable.innerHTML = '<p style="text-align: center; color: #6c757d;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</p>';
        return;
      }
      
      const table = document.createElement('table');
      table.className = 'standings-table';
      
      // Header
      const headerRow = document.createElement('tr');
      const isSwiss = tournamentManager.currentTournament.type === 'swiss';
      headerRow.innerHTML = `
        <th>‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
        <th>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</th>
        <th>‡∏ä‡∏ô‡∏∞</th>
        <th>‡πÄ‡∏™‡∏°‡∏≠</th>
        <th>‡πÅ‡∏û‡πâ</th>
        <th>‡πÅ‡∏û‡πâ‡∏Ñ‡∏π‡πà</th>
        <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
        <th>OW%</th>
        <th>H2H</th>
        ${isSwiss ? '<th>Buchholz</th>' : ''}
      `;
      table.appendChild(headerRow);
      
      // Data rows
      tournamentManager.currentTournament.standings.forEach((player, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="rank">${index + 1}</td>
          <td>${player.name}</td>
          <td>${player.wins}</td>
          <td>${player.draws}</td>
          <td>${player.losses}</td>
          <td>${player.doubleLosses}</td>
          <td class="points">${player.points}</td>
          <td>${(player.owPercent || 0).toFixed(1)}%</td>
          <td>${player.h2hScore || 0}</td>
          ${isSwiss ? `<td>${(player.buchholzScore || 0).toFixed(2)}</td>` : ''}
        `;
        table.appendChild(row);
      });
      
      standingsTable.appendChild(table);
    }
    
    function recordResult(matchId, result) {
      tournamentManager.recordMatchResult(matchId, result);
      updateMatchesDisplay();
      updateStandingsDisplay();
    }
    
    function getResultText(result) {
      switch (result) {
        case 'player1': return '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 1 ‡∏ä‡∏ô‡∏∞';
        case 'player2': return '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 2 ‡∏ä‡∏ô‡∏∞';
        case 'draw': return '‡πÄ‡∏™‡∏°‡∏≠';
        case 'double_loss': return '‡πÅ‡∏û‡πâ‡∏Ñ‡∏π‡πà';
        default: return '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏Ç‡πà‡∏á';
      }
    }
    
    function exportTournament() {
      tournamentManager.exportTournament();
    }
    
    function saveToGoogleSheets() {
      // This would integrate with Google Sheets API
      alert('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï');
    }
    
    // Open display page
    function openDisplayPage() {
      const webUrl = 'pairing-display.html';
      
      console.log('Opening display page:', webUrl);
      
      // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö reference
      window.displayWindow = window.open(webUrl, '_blank');
      
      // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      setTimeout(() => {
        console.log('Sending initial data to display page');
        tournamentManager.sendRealTimeUpdate();
      }, 1000);
      
      alert('‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ö‡∏ö real-time');
    }
    
    function resetTournament() {
      if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Tournament ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ')) {
        // Clear localStorage
        localStorage.removeItem('currentTournament');
        localStorage.removeItem('currentPlayers');
        location.reload();
      }
    }
    
    function goHome() {
      window.location.href = 'index.html';
    }
    
    // Toggle standings visibility
    function toggleStandingsVisibility() {
      standingsVisible = !standingsVisible;
      const btn = document.getElementById('toggleStandingsBtn');
      
      if (standingsVisible) {
        btn.textContent = 'üëÅÔ∏è ‡∏ã‡πà‡∏≠‡∏ô Standing';
        btn.className = 'btn btn-info';
      } else {
        btn.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è ‡πÅ‡∏™‡∏î‡∏á Standing';
        btn.className = 'btn btn-warning';
      }
      
      // Send update to display page
      tournamentManager.sendRealTimeUpdate();
    }
    
    // Swiss Round Functions
    function generateNextRound() {
      if (!tournamentManager.currentTournament || tournamentManager.currentTournament.type !== 'swiss') {
        alert('‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Swiss Round ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
        return;
      }
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡πÅ‡∏°‡∏ï‡∏ä‡πå‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      const currentRound = tournamentManager.currentTournament.currentRound - 1;
      const currentRoundMatches = tournamentManager.currentTournament.matches.filter(m => m.round === currentRound);
      const incompleteMatches = currentRoundMatches.filter(m => m.status !== 'completed');
      
      if (incompleteMatches.length > 0) {
        alert(`‡∏¢‡∏±‡∏á‡∏°‡∏µ‡πÅ‡∏°‡∏ï‡∏ä‡πå‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${currentRound} ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô`);
        return;
      }
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏≠‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      if (currentRound >= tournamentManager.currentTournament.maxRounds) {
        alert('‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ');
        return;
      }
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
      tournamentManager.generateNextSwissRound();
      
      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
      updateMatchesDisplay();
      updateStandingsDisplay();
      updateSwissControls();
      
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      tournamentManager.saveTournament();
      
      alert(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${tournamentManager.currentTournament.currentRound - 1} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`);
    }
    
    function updateSwissControls() {
      if (!tournamentManager.currentTournament || tournamentManager.currentTournament.type !== 'swiss') return;
      
      const currentRound = tournamentManager.currentTournament.currentRound - 1;
      const maxRounds = tournamentManager.currentTournament.maxRounds;
      const nextRoundBtn = document.getElementById('nextRoundBtn');
      
      if (currentRound >= maxRounds) {
        nextRoundBtn.textContent = 'üèÅ ‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô';
        nextRoundBtn.disabled = true;
      } else {
        nextRoundBtn.textContent = `‚û°Ô∏è ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${currentRound + 1}`;
        nextRoundBtn.disabled = false;
      }
    }
    
    function showRoundInfo() {
      if (!tournamentManager.currentTournament || tournamentManager.currentTournament.type !== 'swiss') {
        alert('‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Swiss Round ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
        return;
      }
      
      const currentRound = tournamentManager.currentTournament.currentRound - 1;
      const maxRounds = tournamentManager.currentTournament.maxRounds;
      const totalMatches = tournamentManager.currentTournament.matches.length;
      const completedMatches = tournamentManager.currentTournament.matches.filter(m => m.status === 'completed').length;
      
      alert(`üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Swiss Round\n\n` +
            `‡∏£‡∏≠‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${currentRound}/${maxRounds}\n` +
            `‡πÅ‡∏°‡∏ï‡∏ä‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalMatches}\n` +
            `‡πÅ‡∏°‡∏ï‡∏ä‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß: ${completedMatches}\n` +
            `‡πÅ‡∏°‡∏ï‡∏ä‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${totalMatches - completedMatches}`);
    }
    
    // Quick Add Functions
    function showQuickAddDialog() {
      const playerData = prompt(`‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡πÅ‡∏¢‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà)\n‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•\tID\t‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£\n\n‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:\nNuttawee Kaewmanee\tth09371105\t0809874092\nSettharat Chamneincharoensuk\tth13804977\t0904254810`);
      
      if (playerData) {
        const lines = playerData.split('\n').filter(line => line.trim());
        let addedCount = 0;
        
        lines.forEach(line => {
          const parts = line.split('\t');
          if (parts.length >= 2) {
            const name = parts[0].trim();
            const id = parts[1].trim();
            const phone = parts[2] ? parts[2].trim() : '';
            
            if (name && id) {
              if (tournamentManager.addPlayer(name, id, phone)) {
                addedCount++;
              }
            }
          }
        });
        
        if (addedCount > 0) {
          updatePlayerList();
          if (tournamentManager.currentPlayers.length >= 2) {
            document.getElementById('startBtn').disabled = false;
          }
          alert(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô ${addedCount} ‡∏Ñ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`);
        } else {
          alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
        }
      }
    }
    
    function addSamplePlayers() {
      const samplePlayers = [
        { name: 'Nuttawee Kaewmanee', id: 'th09371105', phone: '0809874092' },
        { name: 'Settharat Chamneincharoensuk', id: 'th13804977', phone: '0904254810' },
        { name: 'Paonrat Jansela', id: 'th82685828', phone: '0995935386' },
        { name: 'Pongnatee Thumsatjanan', id: 'th40945504', phone: '0801839991' },
        { name: 'Irada Thamsatchanan', id: 'th95227396', phone: '0877005313' },
        { name: 'Jakrapong Sertsri', id: 'th22893808', phone: '0825611150' },
        { name: 'Jirayut Saengsiwarit', id: 'th63965294', phone: '0920304181' },
        { name: 'Raksit Wanichphol', id: 'th42944460', phone: '0816977210' }
      ];
      
      let addedCount = 0;
      samplePlayers.forEach(player => {
        if (tournamentManager.addPlayer(player.name, player.id, player.phone)) {
          addedCount++;
        }
      });
      
      if (addedCount > 0) {
        updatePlayerList();
        if (tournamentManager.currentPlayers.length >= 2) {
          document.getElementById('startBtn').disabled = false;
        }
        alert(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ${addedCount} ‡∏Ñ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`);
      }
    }
    
    // Drop Player Functions
    function showDropPlayerDialog() {
      if (!tournamentManager.currentTournament) return;
      
      const activePlayers = tournamentManager.currentTournament.players.filter(p => !p.isDropped);
      if (activePlayers.length === 0) {
        alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Drop ‡πÑ‡∏î‡πâ');
        return;
      }
      
      let playerList = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Drop:\n\n';
      activePlayers.forEach((player, index) => {
        playerList += `${index + 1}. ${player.name} (${player.id})\n`;
      });
      
      const choice = prompt(playerList + '\n‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç (1-' + activePlayers.length + '):');
      const playerIndex = parseInt(choice) - 1;
      
      if (playerIndex >= 0 && playerIndex < activePlayers.length) {
        const player = activePlayers[playerIndex];
        if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Drop ${player.name} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
          if (tournamentManager.dropPlayer(player.id)) {
            updatePlayerList();
            updateStandingsDisplay();
            alert(`Drop ${player.name} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`);
          }
        }
      }
    }
    
    function showUndropPlayerDialog() {
      if (!tournamentManager.currentTournament) return;
      
      const droppedPlayers = tournamentManager.currentTournament.players.filter(p => p.isDropped);
      if (droppedPlayers.length === 0) {
        alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å Drop');
        return;
      }
      
      let playerList = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å Drop:\n\n';
      droppedPlayers.forEach((player, index) => {
        playerList += `${index + 1}. ${player.name} (${player.id})\n`;
      });
      
      const choice = prompt(playerList + '\n‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç (1-' + droppedPlayers.length + '):');
      const playerIndex = parseInt(choice) - 1;
      
      if (playerIndex >= 0 && playerIndex < droppedPlayers.length) {
        const player = droppedPlayers[playerIndex];
        if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å Drop ${player.name} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
          if (tournamentManager.undropPlayer(player.id)) {
            updatePlayerList();
            updateStandingsDisplay();
            alert(`‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å Drop ${player.name} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`);
          }
        }
      }
    }
    
    // Handle Enter key in input fields
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('playerName').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          addPlayer();
        }
      });
      
      document.getElementById('playerId').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          addPlayer();
        }
      });
    });
  </script>
</body>
</html>
